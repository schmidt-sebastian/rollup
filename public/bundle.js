(function(){"use strict";var t=function(e,n){t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n))t[n]=e[n]};return t(e,n)};function e(e,n){if(typeof n!=="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}function n(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r["throw"](t))}catch(t){s(t)}}function c(t){t.done?n(t.value):i(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))}function r(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(t){return function(e){return c([t,e])}}function c(o){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(s=o[0]&2?i["return"]:o[0]?i["throw"]||((s=i["return"])&&s.call(i),0):i.next)&&!(s=s.call(i,o[1])).done)return s;if(i=0,s)o=[o[0]&2,s.value];switch(o[0]){case 0:case 1:s=o;break;case 4:n.label++;return{value:o[1],done:false};case 5:n.label++;i=o[1];o=[0];continue;case 7:o=n.ops.pop();n.trys.pop();continue;default:if(!(s=n.trys,s=s.length>0&&s[s.length-1])&&(o[0]===6||o[0]===2)){n=0;continue}if(o[0]===3&&(!s||o[1]>s[0]&&o[1]<s[3])){n.label=o[1];break}if(o[0]===6&&n.label<s[1]){n.label=s[1];s=o;break}if(s&&n.label<s[2]){n.label=s[2];n.ops.push(o);break}if(s[2])n.ops.pop();n.trys.pop();continue}o=e.call(t,n)}catch(t){o=[6,t];i=0}finally{r=s=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}function i(t){var e=typeof Symbol==="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length==="number")return{next:function(){if(t&&r>=t.length)t=void 0;return{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(t,e){var n=typeof Symbol==="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{while((e===void 0||e-- >0)&&!(i=r.next()).done)s.push(i.value)}catch(t){o={error:t}}finally{try{if(i&&!i.done&&(n=r["return"]))n.call(r)}finally{if(o)throw o.error}}return s}function o(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++){if(s||!(r in e)){if(!s)s=Array.prototype.slice.call(e,0,r);s[r]=e[r]}}return t.concat(s||e)}var a=function(){function t(){var t=this;this.reject=function(){};this.resolve=function(){};this.promise=new Promise((function(e,n){t.resolve=e;t.reject=n}))}t.prototype.wrapCallback=function(t){var e=this;return function(n,r){if(n){e.reject(n)}else{e.resolve(r)}if(typeof t==="function"){e.promise.catch((function(){}));if(t.length===1){t(n)}else{t(n,r)}}}};return t}();function c(){if(typeof navigator!=="undefined"&&typeof navigator["userAgent"]==="string"){return navigator["userAgent"]}else{return""}}function u(){return typeof window!=="undefined"&&!!(window["cordova"]||window["phonegap"]||window["PhoneGap"])&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(c())}function h(){var t=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:undefined;return typeof t==="object"&&t.id!==undefined}function l(){return typeof navigator==="object"&&navigator["product"]==="ReactNative"}function f(){return c().indexOf("Electron/")>=0}function d(){var t=c();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function p(){return c().indexOf("MSAppHost/")>=0}var g="FirebaseError";var m=function(t){e(n,t);function n(e,r,i){var s=t.call(this,r)||this;s.code=e;s.customData=i;s.name=g;Object.setPrototypeOf(s,n.prototype);if(Error.captureStackTrace){Error.captureStackTrace(s,y.prototype.create)}return s}return n}(Error);var y=function(){function t(t,e,n){this.service=t;this.serviceName=e;this.errors=n}t.prototype.create=function(t){var e=[];for(var n=1;n<arguments.length;n++){e[n-1]=arguments[n]}var r=e[0]||{};var i=this.service+"/"+t;var s=this.errors[t];var o=s?v(s,r):"Error";var a=this.serviceName+": "+o+" ("+i+").";var c=new m(i,a,r);return c};return t}();function v(t,e){return t.replace(w,(function(t,n){var r=e[n];return r!=null?String(r):"<"+n+"?>"}))}var w=/\{\$([^}]+)}/g;function b(t){if(t&&t._delegate){return t._delegate}else{return t}}var I=function(){function t(t,e,n){this.name=t;this.instanceFactory=e;this.type=n;this.multipleInstances=false;this.serviceProps={};this.instantiationMode="LAZY";this.onInstanceCreated=null}t.prototype.setInstantiationMode=function(t){this.instantiationMode=t;return this};t.prototype.setMultipleInstances=function(t){this.multipleInstances=t;return this};t.prototype.setServiceProps=function(t){this.serviceProps=t;return this};t.prototype.setInstanceCreatedCallback=function(t){this.onInstanceCreated=t;return this};return t}();var E="[DEFAULT]";var T=function(){function t(t,e){this.name=t;this.container=e;this.component=null;this.instances=new Map;this.instancesDeferred=new Map;this.onInitCallbacks=new Map}t.prototype.get=function(t){var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new a;this.instancesDeferred.set(e,n);if(this.isInitialized(e)||this.shouldAutoInitialize()){try{var r=this.getOrInitializeService({instanceIdentifier:e});if(r){n.resolve(r)}}catch(t){}}}return this.instancesDeferred.get(e).promise};t.prototype.getImmediate=function(t){var e;var n=this.normalizeInstanceIdentifier(t===null||t===void 0?void 0:t.identifier);var r=(e=t===null||t===void 0?void 0:t.optional)!==null&&e!==void 0?e:false;if(this.isInitialized(n)||this.shouldAutoInitialize()){try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r){return null}else{throw t}}}else{if(r){return null}else{throw Error("Service "+this.name+" is not available")}}};t.prototype.getComponent=function(){return this.component};t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name){throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".")}if(this.component){throw Error("Component for "+this.name+" has already been provided")}this.component=t;if(!this.shouldAutoInitialize()){return}if(_(t)){try{this.getOrInitializeService({instanceIdentifier:E})}catch(t){}}try{for(var r=i(this.instancesDeferred.entries()),o=r.next();!o.done;o=r.next()){var a=s(o.value,2),c=a[0],u=a[1];var h=this.normalizeInstanceIdentifier(c);try{var l=this.getOrInitializeService({instanceIdentifier:h});u.resolve(l)}catch(t){}}}catch(t){e={error:t}}finally{try{if(o&&!o.done&&(n=r.return))n.call(r)}finally{if(e)throw e.error}}};t.prototype.clearInstance=function(t){if(t===void 0){t=E}this.instancesDeferred.delete(t);this.instances.delete(t)};t.prototype.delete=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:t=Array.from(this.instances.values());return[4,Promise.all(o(o([],s(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))),s(t.filter((function(t){return"_delete"in t})).map((function(t){return t._delete()})))))];case 1:e.sent();return[2]}}))}))};t.prototype.isComponentSet=function(){return this.component!=null};t.prototype.isInitialized=function(t){if(t===void 0){t=E}return this.instances.has(t)};t.prototype.initialize=function(t){var e,n;if(t===void 0){t={}}var r=t.options,o=r===void 0?{}:r;var a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a)){throw Error(this.name+"("+a+") has already been initialized")}if(!this.isComponentSet()){throw Error("Component "+this.name+" has not been registered yet")}var c=this.getOrInitializeService({instanceIdentifier:a,options:o});try{for(var u=i(this.instancesDeferred.entries()),h=u.next();!h.done;h=u.next()){var l=s(h.value,2),f=l[0],d=l[1];var p=this.normalizeInstanceIdentifier(f);if(a===p){d.resolve(c)}}}catch(t){e={error:t}}finally{try{if(h&&!h.done&&(n=u.return))n.call(u)}finally{if(e)throw e.error}}this.invokeOnInitCallbacks(c,a);return c};t.prototype.onInit=function(t,e){var n;var r=this.normalizeInstanceIdentifier(e);var i=(n=this.onInitCallbacks.get(r))!==null&&n!==void 0?n:new Set;i.add(t);this.onInitCallbacks.set(r,i);var s=this.instances.get(r);if(s){t(s,r)}return function(){i.delete(t)}};t.prototype.invokeOnInitCallbacks=function(t,e){var n,r;var s=this.onInitCallbacks.get(e);if(!s){return}try{for(var o=i(s),a=o.next();!a.done;a=o.next()){var c=a.value;try{c(t,e)}catch(t){}}}catch(t){n={error:t}}finally{try{if(a&&!a.done&&(r=o.return))r.call(o)}finally{if(n)throw n.error}}};t.prototype.getOrInitializeService=function(t){var e=t.instanceIdentifier,n=t.options,r=n===void 0?{}:n;var i=this.instances.get(e);if(!i&&this.component){i=this.component.instanceFactory(this.container,{instanceIdentifier:S(e),options:r});this.instances.set(e,i);if(this.component.onInstanceCreated){try{this.component.onInstanceCreated(this.container,e,i)}catch(t){}}}return i||null};t.prototype.normalizeInstanceIdentifier=function(t){if(t===void 0){t=E}if(this.component){return this.component.multipleInstances?t:E}else{return t}};t.prototype.shouldAutoInitialize=function(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"};return t}();function S(t){return t===E?undefined:t}function _(t){return t.instantiationMode==="EAGER"}var A=function(){function t(t){this.name=t;this.providers=new Map}t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet()){throw new Error("Component "+t.name+" has already been registered with "+this.name)}e.setComponent(t)};t.prototype.addOrOverwriteComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet()){this.providers.delete(t.name)}this.addComponent(t)};t.prototype.getProvider=function(t){if(this.providers.has(t)){return this.providers.get(t)}var e=new T(t,this);this.providers.set(t,e);return e};t.prototype.getProviders=function(){return Array.from(this.providers.values())};return t}();function N(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}var x;var D;(function(t){t[t["DEBUG"]=0]="DEBUG";t[t["VERBOSE"]=1]="VERBOSE";t[t["INFO"]=2]="INFO";t[t["WARN"]=3]="WARN";t[t["ERROR"]=4]="ERROR";t[t["SILENT"]=5]="SILENT"})(D||(D={}));var R={debug:D.DEBUG,verbose:D.VERBOSE,info:D.INFO,warn:D.WARN,error:D.ERROR,silent:D.SILENT};var C=D.INFO;var k=(x={},x[D.DEBUG]="log",x[D.VERBOSE]="log",x[D.INFO]="info",x[D.WARN]="warn",x[D.ERROR]="error",x);var O=function(t,e){var n=[];for(var r=2;r<arguments.length;r++){n[r-2]=arguments[r]}if(e<t.logLevel){return}var i=(new Date).toISOString();var s=k[e];if(s){console[s].apply(console,N(["["+i+"]  "+t.name+":"],n))}else{throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}};var L=function(){function t(t){this.name=t;this._logLevel=C;this._logHandler=O;this._userLogHandler=null}Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in D)){throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`')}this._logLevel=t},enumerable:false,configurable:true});t.prototype.setLogLevel=function(t){this._logLevel=typeof t==="string"?R[t]:t};Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if(typeof t!=="function"){throw new TypeError("Value assigned to `logHandler` must be a function")}this._logHandler=t},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:false,configurable:true});t.prototype.debug=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}this._userLogHandler&&this._userLogHandler.apply(this,N([this,D.DEBUG],t));this._logHandler.apply(this,N([this,D.DEBUG],t))};t.prototype.log=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}this._userLogHandler&&this._userLogHandler.apply(this,N([this,D.VERBOSE],t));this._logHandler.apply(this,N([this,D.VERBOSE],t))};t.prototype.info=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}this._userLogHandler&&this._userLogHandler.apply(this,N([this,D.INFO],t));this._logHandler.apply(this,N([this,D.INFO],t))};t.prototype.warn=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}this._userLogHandler&&this._userLogHandler.apply(this,N([this,D.WARN],t));this._logHandler.apply(this,N([this,D.WARN],t))};t.prototype.error=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}this._userLogHandler&&this._userLogHandler.apply(this,N([this,D.ERROR],t));this._logHandler.apply(this,N([this,D.ERROR],t))};return t}();class P{constructor(t){this.container=t}getPlatformInfoString(){const t=this.container.getProviders();return t.map((t=>{if(M(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}else{return null}})).filter((t=>t)).join(" ")}}function M(t){const e=t.getComponent();return(e===null||e===void 0?void 0:e.type)==="VERSION"}const F="@firebase/app-exp";const V="0.0.900-exp.57f19127c";const U=new L("@firebase/app");const B="@firebase/app-compat";const q="@firebase/analytics-compat";const j="@firebase/analytics-exp";const $="@firebase/auth-exp";const K="@firebase/auth-compat";const z="@firebase/database";const H="@firebase/database-compat";const G="@firebase/functions-exp";const Q="@firebase/functions-compat";const X="@firebase/installations-exp";const W="@firebase/installations-compat";const Y="@firebase/messaging-exp";const J="@firebase/messaging-compat";const Z="@firebase/performance-exp";const tt="@firebase/performance-compat";const et="@firebase/remote-config-exp";const nt="@firebase/remote-config-compat";const rt="@firebase/storage";const it="@firebase/storage-compat";const st="@firebase/firestore";const ot="@firebase/firestore-compat";const at="firebase-exp";const ct="9.0.0-beta.5";const ut="[DEFAULT]";const ht={[F]:"fire-core",[B]:"fire-core-compat",[j]:"fire-analytics",[q]:"fire-analytics-compat",[$]:"fire-auth",[K]:"fire-auth-compat",[z]:"fire-rtdb",[H]:"fire-rtdb-compat",[G]:"fire-fn",[Q]:"fire-fn-compat",[X]:"fire-iid",[W]:"fire-iid-compat",[Y]:"fire-fcm",[J]:"fire-fcm-compat",[Z]:"fire-perf",[tt]:"fire-perf-compat",[et]:"fire-rc",[nt]:"fire-rc-compat",[rt]:"fire-gcs",[it]:"fire-gcs-compat",[st]:"fire-fst",[ot]:"fire-fst-compat","fire-js":"fire-js",[at]:"fire-js-all"};const lt=new Map;const ft=new Map;function dt(t,e){try{t.container.addComponent(e)}catch(n){U.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function pt(t){const e=t.name;if(ft.has(e)){U.debug(`There were multiple attempts to register component ${e}.`);return false}ft.set(e,t);for(const e of lt.values()){dt(e,t)}return true}function gt(t,e){return t.container.getProvider(e)}const mt={["no-app"]:"No Firebase App '{$appName}' has been created - "+"call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a "+"Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function."};const yt=new y("app","Firebase",mt);class vt{constructor(t,e,n){this._isDeleted=false;this._options=Object.assign({},t);this._name=e.name;this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled;this._container=n;this.container.addComponent(new I("app-exp",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){this.checkDestroyed();return this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed();this._automaticDataCollectionEnabled=t}get name(){this.checkDestroyed();return this._name}get options(){this.checkDestroyed();return this._options}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted){throw yt.create("app-deleted",{appName:this._name})}}}const wt=ct;function bt(t,e={}){if(typeof e!=="object"){const t=e;e={name:t}}const n=Object.assign({name:ut,automaticDataCollectionEnabled:false},e);const r=n.name;if(typeof r!=="string"||!r){throw yt.create("bad-app-name",{appName:String(r)})}if(lt.has(r)){throw yt.create("duplicate-app",{appName:r})}const i=new A(r);for(const t of ft.values()){i.addComponent(t)}const s=new vt(t,n,i);lt.set(r,s);return s}function It(t,e,n){var r;let i=(r=ht[t])!==null&&r!==void 0?r:t;if(n){i+=`-${n}`}const s=i.match(/\s|\//);const o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${i}" with version "${e}":`];if(s){t.push(`library name "${i}" contains illegal characters (whitespace or "/")`)}if(s&&o){t.push("and")}if(o){t.push(`version name "${e}" contains illegal characters (whitespace or "/")`)}U.warn(t.join(" "));return}pt(new I(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}function Et(t){pt(new I("platform-logger",(t=>new P(t)),"PRIVATE"));It(F,V,t);It("fire-js","")}Et();var Tt;(function(t){t[t["NO_ERROR"]=0]="NO_ERROR";t[t["NETWORK_ERROR"]=1]="NETWORK_ERROR";t[t["ABORT"]=2]="ABORT"})(Tt||(Tt={}));const St="firebasestorage.googleapis.com";const _t="storageBucket";const At=2*60*1e3;const Nt=10*60*1e3;class xt extends m{constructor(t,e){super(Dt(t),`Firebase Storage: ${e} (${Dt(t)})`);this.customData={serverResponse:null};this._baseMessage=this.message;Object.setPrototypeOf(this,xt.prototype)}_codeEquals(t){return Dt(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t;if(this.customData.serverResponse){this.message=`${this._baseMessage}\n${this.customData.serverResponse}`}else{this.message=this._baseMessage}}}function Dt(t){return"storage/"+t}function Rt(){const t="An unknown error occurred, please check the error payload for "+"server response.";return new xt("unknown",t)}function Ct(){return new xt("retry-limit-exceeded","Max retry time for operation exceeded, please try again.")}function kt(){return new xt("canceled","User canceled the upload/download.")}function Ot(t){return new xt("invalid-url","Invalid URL '"+t+"'.")}function Lt(t){return new xt("invalid-default-bucket","Invalid default bucket '"+t+"'.")}function Pt(t){return new xt("invalid-argument",t)}function Mt(){return new xt("app-deleted","The Firebase app was deleted.")}function Ft(t){return new xt("invalid-root-operation","The operation '"+t+"' cannot be performed on a root reference, create a non-root "+"reference using child, such as .child('file.png').")}function Vt(t){throw new xt("internal-error","Internal error: "+t)}class Ut{constructor(){this.sent_=false;this.xhr_=new XMLHttpRequest;this.errorCode_=Tt.NO_ERROR;this.sendPromise_=new Promise((t=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=Tt.ABORT;t(this)}));this.xhr_.addEventListener("error",(()=>{this.errorCode_=Tt.NETWORK_ERROR;t(this)}));this.xhr_.addEventListener("load",(()=>{t(this)}))}))}send(t,e,n,r){if(this.sent_){throw Vt("cannot .send() more than once")}this.sent_=true;this.xhr_.open(e,t,true);if(r!==undefined){for(const t in r){if(r.hasOwnProperty(t)){this.xhr_.setRequestHeader(t,r[t].toString())}}}if(n!==undefined){this.xhr_.send(n)}else{this.xhr_.send()}return this.sendPromise_}getErrorCode(){if(!this.sent_){throw Vt("cannot .getErrorCode() before sending")}return this.errorCode_}getStatus(){if(!this.sent_){throw Vt("cannot .getStatus() before sending")}try{return this.xhr_.status}catch(t){return-1}}getResponseText(){if(!this.sent_){throw Vt("cannot .getResponseText() before sending")}return this.xhr_.responseText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){if(this.xhr_.upload!=null){this.xhr_.upload.addEventListener("progress",t)}}removeUploadProgressListener(t){if(this.xhr_.upload!=null){this.xhr_.upload.removeEventListener("progress",t)}}}class Bt{createXhrIo(){return new Ut}}class qt{constructor(t,e){this.bucket=t;this.path_=e}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=qt.makeFromUrl(t,e)}catch(e){return new qt(t,"")}if(n.path===""){return n}else{throw Lt(t)}}static makeFromUrl(t,e){let n=null;const r="([A-Za-z0-9.\\-_]+)";function i(t){if(t.path.charAt(t.path.length-1)==="/"){t.path_=t.path_.slice(0,-1)}}const s="(/(.*))?$";const o=new RegExp("^gs://"+r+s,"i");const a={bucket:1,path:3};function c(t){t.path_=decodeURIComponent(t.path)}const u="v[A-Za-z0-9_]+";const h=e.replace(/[.]/g,"\\.");const l="(/([^?#]*).*)?$";const f=new RegExp(`^https?://${h}/${u}/b/${r}/o${l}`,"i");const d={bucket:1,path:3};const p=e===St?"(?:storage.googleapis.com|storage.cloud.google.com)":e;const g="([^?#]*)";const m=new RegExp(`^https?://${p}/${r}/${g}`,"i");const y={bucket:1,path:2};const v=[{regex:o,indices:a,postModify:i},{regex:f,indices:d,postModify:c},{regex:m,indices:y,postModify:c}];for(let e=0;e<v.length;e++){const r=v[e];const i=r.regex.exec(t);if(i){const t=i[r.indices.bucket];let e=i[r.indices.path];if(!e){e=""}n=new qt(t,e);r.postModify(n);break}}if(n==null){throw Ot(t)}return n}}class jt{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=false){}}function $t(t,e,n){let r=1;let i=null;let s=false;let o=0;function a(){return o===2}let c=false;function u(...t){if(!c){c=true;e.apply(null,t)}}function h(e){i=setTimeout((()=>{i=null;t(l,a())}),e)}function l(t,...e){if(c){return}if(t){u.call(null,t,...e);return}const n=a()||s;if(n){u.call(null,t,...e);return}if(r<64){r*=2}let i;if(o===1){o=2;i=0}else{i=(r+Math.random())*1e3}h(i)}let f=false;function d(t){if(f){return}f=true;if(c){return}if(i!==null){if(!t){o=2}clearTimeout(i);h(0)}else{if(!t){o=1}}}h(0);setTimeout((()=>{s=true;d(true)}),n);return d}function Kt(t){t(false)}function zt(t){return t!==void 0}function Ht(t,e,n,r){if(r<e){throw Pt(`Invalid value for '${t}'. Expected ${e} or greater.`)}if(r>n){throw Pt(`Invalid value for '${t}'. Expected ${n} or less.`)}}function Gt(t){const e=encodeURIComponent;let n="?";for(const r in t){if(t.hasOwnProperty(r)){const i=e(r)+"="+e(t[r]);n=n+i+"&"}}n=n.slice(0,-1);return n}class Qt{constructor(t,e,n,r,i,s,o,a,c,u,h){this.pendingXhr_=null;this.backoffId_=null;this.canceled_=false;this.appDelete_=false;this.url_=t;this.method_=e;this.headers_=n;this.body_=r;this.successCodes_=i.slice();this.additionalRetryCodes_=s.slice();this.callback_=o;this.errorCallback_=a;this.progressCallback_=u;this.timeout_=c;this.pool_=h;this.promise_=new Promise(((t,e)=>{this.resolve_=t;this.reject_=e;this.start_()}))}start_(){const t=this;function e(e,n){if(n){e(false,new Xt(false,null,true));return}const r=t.pool_.createXhrIo();t.pendingXhr_=r;function i(e){const n=e.loaded;const r=e.lengthComputable?e.total:-1;if(t.progressCallback_!==null){t.progressCallback_(n,r)}}if(t.progressCallback_!==null){r.addUploadProgressListener(i)}r.send(t.url_,t.method_,t.body_,t.headers_).then((n=>{if(t.progressCallback_!==null){n.removeUploadProgressListener(i)}t.pendingXhr_=null;n=n;const r=n.getErrorCode()===Tt.NO_ERROR;const s=n.getStatus();if(!r||t.isRetryStatusCode_(s)){const t=n.getErrorCode()===Tt.ABORT;e(false,new Xt(false,null,t));return}const o=t.successCodes_.indexOf(s)!==-1;e(true,new Xt(o,n))}))}function n(e,n){const r=t.resolve_;const i=t.reject_;const s=n.xhr;if(n.wasSuccessCode){try{const e=t.callback_(s,s.getResponseText());if(zt(e)){r(e)}else{r()}}catch(t){i(t)}}else{if(s!==null){const e=Rt();e.serverResponse=s.getResponseText();if(t.errorCallback_){i(t.errorCallback_(s,e))}else{i(e)}}else{if(n.canceled){const e=t.appDelete_?Mt():kt();i(e)}else{const t=Ct();i(t)}}}}if(this.canceled_){n(false,new Xt(false,null,true))}else{this.backoffId_=$t(e,n,this.timeout_)}}getPromise(){return this.promise_}cancel(t){this.canceled_=true;this.appDelete_=t||false;if(this.backoffId_!==null){Kt(this.backoffId_)}if(this.pendingXhr_!==null){this.pendingXhr_.abort()}}isRetryStatusCode_(t){const e=t>=500&&t<600;const n=[408,429];const r=n.indexOf(t)!==-1;const i=this.additionalRetryCodes_.indexOf(t)!==-1;return e||r||i}}class Xt{constructor(t,e,n){this.wasSuccessCode=t;this.xhr=e;this.canceled=!!n}}function Wt(t,e){if(e!==null&&e.length>0){t["Authorization"]="Firebase "+e}}function Yt(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e!==null&&e!==void 0?e:"AppManager")}function Jt(t,e){if(e){t["X-Firebase-GMPID"]=e}}function Zt(t,e){if(e!==null){t["X-Firebase-AppCheck"]=e}}function te(t,e,n,r,i,s){const o=Gt(t.urlParams);const a=t.url+o;const c=Object.assign({},t.headers);Jt(c,e);Wt(c,n);Yt(c,s);Zt(c,r);return new Qt(a,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i)}function ee(t){if(t.length===0){return null}const e=t.lastIndexOf("/");if(e===-1){return""}const n=t.slice(0,e);return n}function ne(t){const e=t.lastIndexOf("/",t.length-2);if(e===-1){return t}else{return t.slice(e+1)}}class re{constructor(t,e){this._service=t;if(e instanceof qt){this._location=e}else{this._location=qt.makeFromUrl(e,t.host)}}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new re(t,e)}get root(){const t=new qt(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return ne(this._location.path)}get storage(){return this._service}get parent(){const t=ee(this._location.path);if(t===null){return null}const e=new qt(this._location.bucket,t);return new re(this._service,e)}_throwIfRoot(t){if(this._location.path===""){throw Ft(t)}}}function ie(t,e){const n=e===null||e===void 0?void 0:e[_t];if(n==null){return null}return qt.makeFromBucketSpec(n,t)}class se{constructor(t,e,n,r,i,s){this.app=t;this._authProvider=e;this._appCheckProvider=n;this._pool=r;this._url=i;this._firebaseVersion=s;this._bucket=null;this._host=St;this._appId=null;this._deleted=false;this._maxOperationRetryTime=At;this._maxUploadRetryTime=Nt;this._requests=new Set;if(i!=null){this._bucket=qt.makeFromBucketSpec(i,this._host)}else{this._bucket=ie(this._host,this.app.options)}}get host(){return this._host}set host(t){this._host=t;if(this._url!=null){this._bucket=qt.makeFromBucketSpec(this._url,t)}else{this._bucket=ie(t,this.app.options)}}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){Ht("time",0,Number.POSITIVE_INFINITY,t);this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){Ht("time",0,Number.POSITIVE_INFINITY,t);this._maxOperationRetryTime=t}async _getAuthToken(){const t=this._authProvider.getImmediate({optional:true});if(t){const e=await t.getToken();if(e!==null){return e.accessToken}}return null}async _getAppCheckToken(){const t=this._appCheckProvider.getImmediate({optional:true});if(t){const e=await t.getToken();return e.token}return null}_delete(){this._deleted=true;this._requests.forEach((t=>t.cancel()));this._requests.clear();return Promise.resolve()}_makeStorageReference(t){return new re(this,t)}_makeRequest(t,e,n){if(!this._deleted){const r=te(t,this._appId,e,n,this._pool,this._firebaseVersion);this._requests.add(r);r.getPromise().then((()=>this._requests.delete(r)),(()=>this._requests.delete(r)));return r}else{return new jt(Mt())}}async makeRequestWithTokens(t){const[e,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,n)}}const oe="@firebase/storage";const ae="0.0.900-exp.57f19127c";const ce="storage-exp";function ue(t,{instanceIdentifier:e}){const n=t.getProvider("app-exp").getImmediate();const r=t.getProvider("auth-internal");const i=t.getProvider("app-check-internal");return new se(n,r,i,new Bt,e,wt)}function he(){pt(new I(ce,ue,"PUBLIC").setMultipleInstances(true));It(oe,ae)}he();var le=function(t,e){le=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n))t[n]=e[n]};return le(t,e)};function fe(t,e){le(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function de(t){var e=typeof Symbol==="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length==="number")return{next:function(){if(t&&r>=t.length)t=void 0;return{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var pe=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};var ge,me=me||{},ye=pe||self;function ve(){}function we(t){var e=typeof t;e="object"!=e?e:t?Array.isArray(t)?"array":e:"null";return"array"==e||"object"==e&&"number"==typeof t.length}function be(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function Ie(t){return Object.prototype.hasOwnProperty.call(t,Ee)&&t[Ee]||(t[Ee]=++Te)}var Ee="closure_uid_"+(1e9*Math.random()>>>0),Te=0;function Se(t,e,n){return t.call.apply(t.bind,arguments)}function _e(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(n,r);return t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Ae(t,e,n){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ae=Se:Ae=_e;return Ae.apply(null,arguments)}function Ne(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();e.push.apply(e,arguments);return t.apply(this,e)}}function xe(t,e){function n(){}n.prototype=e.prototype;t.Z=e.prototype;t.prototype=new n;t.prototype.constructor=t;t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function De(){this.s=this.s;this.o=this.o}var Re=0;De.prototype.s=!1;De.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0!=Re)){var t=Ie(this)}};De.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Ce=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"===typeof t)return"string"!==typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},ke=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){var r=t.length,i="string"===typeof t?t.split(""):t;for(var s=0;s<r;s++)s in i&&e.call(n,i[s],s,t)};function Oe(t){t:{var e=Yi;var n=t.length,r="string"===typeof t?t.split(""):t;for(var i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"===typeof t?t.charAt(e):t[e]}function Le(t){return Array.prototype.concat.apply([],arguments)}function Pe(t){var e=t.length;if(0<e){var n=Array(e);for(var r=0;r<e;r++)n[r]=t[r];return n}return[]}function Me(t){return/^[\s\xa0]*$/.test(t)}var Fe=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Ve(t,e){return-1!=t.indexOf(e)}function Ue(t,e){return t<e?-1:t>e?1:0}var Be;t:{var qe=ye.navigator;if(qe){var je=qe.userAgent;if(je){Be=je;break t}}Be=""}function $e(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Ke(t){var e={};for(var n in t)e[n]=t[n];return e}var ze="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function He(t,e){var n,r;for(var i=1;i<arguments.length;i++){r=arguments[i];for(n in r)t[n]=r[n];for(var s=0;s<ze.length;s++)n=ze[s],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Ge(t){Ge[" "](t);return t}Ge[" "]=ve;function Qe(t){var e=an;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}var Xe=Ve(Be,"Opera"),We=Ve(Be,"Trident")||Ve(Be,"MSIE"),Ye=Ve(Be,"Edge"),Je=Ye||We,Ze=Ve(Be,"Gecko")&&!(Ve(Be.toLowerCase(),"webkit")&&!Ve(Be,"Edge"))&&!(Ve(Be,"Trident")||Ve(Be,"MSIE"))&&!Ve(Be,"Edge"),tn=Ve(Be.toLowerCase(),"webkit")&&!Ve(Be,"Edge");function en(){var t=ye.document;return t?t.documentMode:void 0}var nn;t:{var rn="",sn=function(){var t=Be;if(Ze)return/rv:([^\);]+)(\)|;)/.exec(t);if(Ye)return/Edge\/([\d\.]+)/.exec(t);if(We)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(tn)return/WebKit\/(\S+)/.exec(t);if(Xe)return/(?:Version)[ \/]?(\S+)/.exec(t)}();sn&&(rn=sn?sn[1]:"");if(We){var on=en();if(null!=on&&on>parseFloat(rn)){nn=String(on);break t}}nn=rn}var an={};function cn(){return Qe((function(){var t=0;var e=Fe(String(nn)).split("."),n=Fe("9").split("."),r=Math.max(e.length,n.length);for(var i=0;0==t&&i<r;i++){var s=e[i]||"",o=n[i]||"";do{s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""];o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""];if(0==s[0].length&&0==o[0].length)break;t=Ue(0==s[1].length?0:parseInt(s[1],10),0==o[1].length?0:parseInt(o[1],10))||Ue(0==s[2].length,0==o[2].length)||Ue(s[2],o[2]);s=s[3];o=o[3]}while(0==t)}return 0<=t}))}var un;if(ye.document&&We){var hn=en();un=hn?hn:parseInt(nn,10)||void 0}else un=void 0;var ln=un;var fn=function(){if(!ye.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{ye.addEventListener("test",ve,e),ye.removeEventListener("test",ve,e)}catch(t){}return t}();function dn(t,e){this.type=t;this.g=this.target=e;this.defaultPrevented=!1}dn.prototype.h=function(){this.defaultPrevented=!0};function pn(t,e){dn.call(this,t?t.type:"");this.relatedTarget=this.g=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=0;this.key="";this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.state=null;this.pointerId=0;this.pointerType="";this.i=null;if(t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;this.target=t.target||t.srcElement;this.g=e;if(e=t.relatedTarget){if(Ze){t:{try{Ge(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e;r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0);this.button=t.button;this.key=t.key||"";this.ctrlKey=t.ctrlKey;this.altKey=t.altKey;this.shiftKey=t.shiftKey;this.metaKey=t.metaKey;this.pointerId=t.pointerId||0;this.pointerType="string"===typeof t.pointerType?t.pointerType:gn[t.pointerType]||"";this.state=t.state;this.i=t;t.defaultPrevented&&pn.Z.h.call(this)}}xe(pn,dn);var gn={2:"touch",3:"pen",4:"mouse"};pn.prototype.h=function(){pn.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var mn="closure_listenable_"+(1e6*Math.random()|0);var yn=0;function vn(t,e,n,r,i){this.listener=t;this.proxy=null;this.src=e;this.type=n;this.capture=!!r;this.ia=i;this.key=++yn;this.ca=this.fa=!1}function wn(t){t.ca=!0;t.listener=null;t.proxy=null;t.src=null;t.ia=null}function bn(t){this.src=t;this.g={};this.h=0}bn.prototype.add=function(t,e,n,r,i){var s=t.toString();t=this.g[s];t||(t=this.g[s]=[],this.h++);var o=En(t,e,r,i);-1<o?(e=t[o],n||(e.fa=!1)):(e=new vn(e,this.src,s,!!r,i),e.fa=n,t.push(e));return e};function In(t,e){var n=e.type;if(n in t.g){var r=t.g[n],i=Ce(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1);s&&(wn(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function En(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.ca&&s.listener==e&&s.capture==!!n&&s.ia==r)return i}return-1}var Tn="closure_lm_"+(1e6*Math.random()|0),Sn={};function _n(t,e,n,r,i){if(r&&r.once)return xn(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)_n(t,e[s],n,r,i);return null}n=Pn(n);return t&&t[mn]?t.N(e,n,be(r)?!!r.capture:!!r,i):An(t,e,n,!1,r,i)}function An(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=be(i)?!!i.capture:!!i,a=On(t);a||(t[Tn]=a=new bn(t));n=a.add(e,n,r,o,s);if(n.proxy)return n;r=Nn();n.proxy=r;r.src=t;r.listener=n;if(t.addEventListener)fn||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Cn(e.toString()),r);else if(t.addListener&&t.removeListener)t.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Nn(){function t(n){return e.call(t.src,t.listener,n)}var e=kn;return t}function xn(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)xn(t,e[s],n,r,i);return null}n=Pn(n);return t&&t[mn]?t.O(e,n,be(r)?!!r.capture:!!r,i):An(t,e,n,!0,r,i)}function Dn(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Dn(t,e[s],n,r,i);else(r=be(r)?!!r.capture:!!r,n=Pn(n),t&&t[mn])?(t=t.i,e=String(e).toString(),e in t.g&&(s=t.g[e],n=En(s,n,r,i),-1<n&&(wn(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--)))):t&&(t=On(t))&&(e=t.g[e.toString()],t=-1,e&&(t=En(e,n,r,i)),(n=-1<t?e[t]:null)&&Rn(n))}function Rn(t){if("number"!==typeof t&&t&&!t.ca){var e=t.src;if(e&&e[mn])In(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Cn(n),r):e.addListener&&e.removeListener&&e.removeListener(r);(n=On(e))?(In(n,t),0==n.h&&(n.src=null,e[Tn]=null)):wn(t)}}}function Cn(t){return t in Sn?Sn[t]:Sn[t]="on"+t}function kn(t,e){if(t.ca)t=!0;else{e=new pn(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&Rn(t);t=n.call(r,e)}return t}function On(t){t=t[Tn];return t instanceof bn?t:null}var Ln="__closure_events_fn_"+(1e9*Math.random()>>>0);function Pn(t){if("function"===typeof t)return t;t[Ln]||(t[Ln]=function(e){return t.handleEvent(e)});return t[Ln]}function Mn(){De.call(this);this.i=new bn(this);this.P=this;this.I=null}xe(Mn,De);Mn.prototype[mn]=!0;Mn.prototype.removeEventListener=function(t,e,n,r){Dn(this,t,e,n,r)};function Fn(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);t=t.P;r=e.type||e;if("string"===typeof e)e=new dn(e,t);else if(e instanceof dn)e.target=e.target||t;else{var i=e;e=new dn(r,t);He(e,i)}i=!0;if(n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=Vn(o,r,!0,e)&&i}o=e.g=t;i=Vn(o,r,!0,e)&&i;i=Vn(o,r,!1,e)&&i;if(n)for(s=0;s<n.length;s++)o=e.g=n[s],i=Vn(o,r,!1,e)&&i}Mn.prototype.M=function(){Mn.Z.M.call(this);if(this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)wn(n[r]);delete t.g[e];t.h--}}this.I=null};Mn.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)};Mn.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};function Vn(t,e,n,r){e=t.i.g[String(e)];if(!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&In(t.i,o);i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}var Un=ye.JSON.stringify;function Bn(){var t=Xn;var e=null;t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null);return e}var qn=function(){function t(){this.h=this.g=null}t.prototype.add=function(t,e){var n=jn.get();n.set(t,e);this.h?this.h.next=n:this.g=n;this.h=n};return t}();var jn=new(function(){function t(t,e){this.i=t;this.j=e;this.h=0;this.g=null}t.prototype.get=function(){var t;0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i();return t};return t}())((function(){return new $n}),(function(t){return t.reset()}));var $n=function(){function t(){this.next=this.g=this.h=null}t.prototype.set=function(t,e){this.h=t;this.g=e;this.next=null};t.prototype.reset=function(){this.next=this.g=this.h=null};return t}();function Kn(t){ye.setTimeout((function(){throw t}),0)}function zn(t,e){Hn||Gn();Qn||(Hn(),Qn=!0);Xn.add(t,e)}var Hn;function Gn(){var t=ye.Promise.resolve(void 0);Hn=function(){t.then(Wn)}}var Qn=!1,Xn=new qn;function Wn(){for(var t;t=Bn();){try{t.h.call(t.g)}catch(t){Kn(t)}var e=jn;e.j(t);100>e.h&&(e.h++,t.next=e.g,e.g=t)}Qn=!1}function Yn(t,e){Mn.call(this);this.h=t||1;this.g=e||ye;this.j=Ae(this.kb,this);this.l=Date.now()}xe(Yn,Mn);ge=Yn.prototype;ge.da=!1;ge.S=null;ge.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Fn(this,"tick"),this.da&&(Jn(this),this.start()))}};ge.start=function(){this.da=!0;this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Jn(t){t.da=!1;t.S&&(t.g.clearTimeout(t.S),t.S=null)}ge.M=function(){Yn.Z.M.call(this);Jn(this);delete this.g};function Zn(t,e,n){if("function"===typeof t)n&&(t=Ae(t,n));else if(t&&"function"==typeof t.handleEvent)t=Ae(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:ye.setTimeout(t,e||0)}function tr(t){t.g=Zn((function(){t.g=null;t.i&&(t.i=!1,tr(t))}),t.j);var e=t.h;t.h=null;t.m.apply(null,e)}var er=function(t){fe(e,t);function e(e,n){var r=t.call(this)||this;r.m=e;r.j=n;r.h=null;r.i=!1;r.g=null;return r}e.prototype.l=function(t){this.h=arguments;this.g?this.i=!0:tr(this)};e.prototype.M=function(){t.prototype.M.call(this);this.g&&(ye.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)};return e}(De);function nr(t){De.call(this);this.h=t;this.g={}}xe(nr,De);var rr=[];function ir(t,e,n,r){Array.isArray(n)||(n&&(rr[0]=n.toString()),n=rr);for(var i=0;i<n.length;i++){var s=_n(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function sr(t){$e(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Rn(t)}),t);t.g={}}nr.prototype.M=function(){nr.Z.M.call(this);sr(this)};nr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function or(){this.g=!0}or.prototype.Aa=function(){this.g=!1};function ar(t,e,n,r,i,s){t.info((function(){if(t.g)if(s){var o="";for(var a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"="+u+"&"):o+(h+"=redacted&")}}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}function cr(t,e,n,r,i,s,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o}))}function ur(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+lr(t,n)+(r?" "+r:"")}))}function hr(t,e){t.info((function(){return"TIMEOUT: "+e}))}or.prototype.info=function(){};function lr(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Un(n)}catch(t){return e}}var fr={},dr=null;function pr(){return dr=dr||new Mn}fr.Ma="serverreachability";function gr(t){dn.call(this,fr.Ma,t)}xe(gr,dn);function mr(t){var e=pr();Fn(e,new gr(e,t))}fr.STAT_EVENT="statevent";function yr(t,e){dn.call(this,fr.STAT_EVENT,t);this.stat=e}xe(yr,dn);function vr(t){var e=pr();Fn(e,new yr(e,t))}fr.Na="timingevent";function wr(t,e){dn.call(this,fr.Na,t);this.size=e}xe(wr,dn);function br(t,e){if("function"!==typeof t)throw Error("Fn must not be null and must be a function");return ye.setTimeout((function(){t()}),e)}var Ir={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9};var Er={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Tr(){}Tr.prototype.h=null;function Sr(t){return t.h||(t.h=t.i())}function _r(){}var Ar={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Nr(){dn.call(this,"d")}xe(Nr,dn);function xr(){dn.call(this,"c")}xe(xr,dn);var Dr;function Rr(){}xe(Rr,Tr);Rr.prototype.g=function(){return new XMLHttpRequest};Rr.prototype.i=function(){return{}};Dr=new Rr;function Cr(t,e,n,r){this.l=t;this.j=e;this.m=n;this.X=r||1;this.V=new nr(this);this.P=Or;t=Je?125:void 0;this.W=new Yn(t);this.H=null;this.i=!1;this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null;this.D=[];this.g=null;this.C=0;this.o=this.u=null;this.N=-1;this.I=!1;this.O=0;this.L=null;this.aa=this.J=this.$=this.U=!1;this.h=new kr}function kr(){this.i=null;this.g="";this.h=!1}var Or=45e3,Lr={},Pr={};ge=Cr.prototype;ge.setTimeout=function(t){this.P=t};function Mr(t,e,n){t.K=1;t.v=ai(ei(e));t.s=n;t.U=!0;Fr(t,null)}function Fr(t,e){t.F=Date.now();qr(t);t.A=ei(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]);Ei(n.h,"t",r);t.C=0;n=t.l.H;t.h=new kr;t.g=xs(t.l,n?e:null,!t.s);0<t.O&&(t.L=new er(Ae(t.Ia,t,t.g),t.O));ir(t.V,t.g,"readystatechange",t.gb);e=t.H?Ke(t.H):{};t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e));mr(1);ar(t.j,t.u,t.A,t.m,t.X,t.s)}ge.gb=function(t){t=t.target;var e=this.L;e&&3==rs(t)?e.l():this.Ia(t)};ge.Ia=function(t){try{if(t==this.g)t:{var e=rs(this.g);var n=this.g.Da();var r=this.g.ba();if(!(3>e)&&(3!=e||Je||this.g&&(this.h.h||this.g.ga()||is(this.g)))){this.I||4!=e||7==n||(8==n||0>=r?mr(3):mr(2));$r(this);var i=this.g.ba();this.N=i;e:if(Vr(this)){var s=is(this.g);t="";var o=s.length,a=4==rs(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){zr(this);Kr(this);var c="";break e}this.h.i=new ye.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,t+=this.h.i.decode(s[n],{stream:a&&n==o-1});s.splice(0,o);this.h.g+=t;this.C=0;c=this.h.g}else c=this.g.ga();this.i=200==i;cr(this.j,this.u,this.A,this.m,this.X,e,i);if(this.i){if(this.$&&!this.J){e:{if(this.g){var u,h=this.g;if((u=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Me(u)){var l=u;break e}}l=null}if(i=l)ur(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Hr(this,i);else{this.i=!1;this.o=3;vr(12);zr(this);Kr(this);break t}}this.U?(Ur(this,e,c),Je&&this.i&&3==e&&(ir(this.V,this.W,"tick",this.fb),this.W.start())):(ur(this.j,this.m,c,null),Hr(this,c));4==e&&zr(this);this.i&&!this.I&&(4==e?Ts(this.l,this):(this.i=!1,qr(this)))}else 400==i&&0<c.indexOf("Unknown SID")?(this.o=3,vr(12)):(this.o=0,vr(13)),zr(this),Kr(this)}}}catch(e){}finally{}};function Vr(t){return t.g?"GET"==t.u&&2!=t.K&&t.l.Ba:!1}function Ur(t,e,n){var r=!0,i;for(;!t.I&&t.C<n.length;)if(i=Br(t,n),i==Pr){4==e&&(t.o=4,vr(14),r=!1);ur(t.j,t.m,null,"[Incomplete Response]");break}else if(i==Lr){t.o=4;vr(15);ur(t.j,t.m,n,"[Invalid Chunk]");r=!1;break}else ur(t.j,t.m,i,null),Hr(t,i);Vr(t)&&i!=Pr&&i!=Lr&&(t.h.g="",t.C=0);4!=e||0!=n.length||t.h.h||(t.o=1,vr(16),r=!1);t.i=t.i&&r;r?0<n.length&&!t.aa&&(t.aa=!0,e=t.l,e.g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),bs(e),e.L=!0,vr(11))):(ur(t.j,t.m,n,"[Invalid Chunked Response]"),zr(t),Kr(t))}ge.fb=function(){if(this.g){var t=rs(this.g),e=this.g.ga();this.C<e.length&&($r(this),Ur(this,t,e),this.i&&4!=t&&qr(this))}};function Br(t,e){var n=t.C,r=e.indexOf("\n",n);if(-1==r)return Pr;n=Number(e.substring(n,r));if(isNaN(n))return Lr;r+=1;if(r+n>e.length)return Pr;e=e.substr(r,n);t.C=r+n;return e}ge.cancel=function(){this.I=!0;zr(this)};function qr(t){t.Y=Date.now()+t.P;jr(t,t.P)}function jr(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=br(Ae(t.eb,t),e)}function $r(t){t.B&&(ye.clearTimeout(t.B),t.B=null)}ge.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(hr(this.j,this.A),2!=this.K&&(mr(3),vr(17)),zr(this),this.o=2,Kr(this)):jr(this,this.Y-t)};function Kr(t){0==t.l.G||t.I||Ts(t.l,t)}function zr(t){$r(t);var e=t.L;e&&"function"==typeof e.na&&e.na();t.L=null;Jn(t.W);sr(t.V);t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Hr(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Ri(n.i,t)))if(n.I=t.N,!t.J&&Ri(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(s){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0])t:{if(!n.u){if(n.g)if(n.g.F+3e3<t.F)Es(n),hs(n);else break t;ws(n);vr(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=br(Ae(n.ab,n),6e3));if(1>=Di(n.i)&&n.ka){try{n.ka()}catch(s){}n.ka=void 0}}else _s(n,11)}else if((t.J||n.g==t)&&Es(n),!Me(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var s=i[e];n.U=s[0];s=s[1];if(2==n.G)if("c"==s[0]){n.J=s[1];n.la=s[2];var o=s[3];null!=o&&(n.ma=o,n.h.info("VER="+n.ma));var a=s[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var c=s[5];null!=c&&"number"===typeof c&&0<c&&(r=1.5*c,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r));r=n;var u=t.g;if(u){var h=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(Ve(h,"spdy")||Ve(h,"quic")||Ve(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(Ci(l,l.h),l.h=null))}if(r.D){var f=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,oi(r.F,r.D,f))}}n.G=3;n.j&&n.j.xa();n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));r=n;var d=t;r.oa=Ns(r,r.H?r.la:null,r.W);if(d.J){ki(r.i,d);var p=d,g=r.K;g&&p.setTimeout(g);p.B&&($r(p),qr(p));r.g=d}else vs(r);0<n.l.length&&ds(n)}else"stop"!=s[0]&&"close"!=s[0]||_s(n,7);else 3==n.G&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?_s(n,7):us(n):"noop"!=s[0]&&n.j&&n.j.wa(s),n.A=0)}mr(4)}catch(s){}}function Gr(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"===typeof t)return t.split("");if(we(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}e=[];n=0;for(r in t)e[n++]=t[r];return e}function Qr(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(we(t)||"string"===typeof t)ke(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(we(t)||"string"===typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;r=Gr(t);i=r.length;for(var s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}}function Xr(t,e){this.h={};this.g=[];this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Xr)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}ge=Xr.prototype;ge.R=function(){Wr(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t};ge.T=function(){Wr(this);return this.g.concat()};function Wr(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Yr(t.h,r)&&(t.g[n++]=r);e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)r=t.g[e],Yr(i,r)||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}ge.get=function(t,e){return Yr(this.h,t)?this.h[t]:e};ge.set=function(t,e){Yr(this.h,t)||(this.i++,this.g.push(t));this.h[t]=e};ge.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);t.call(e,s,i,this)}};function Yr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var Jr=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Zr(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function ti(t,e){this.i=this.s=this.j="";this.m=null;this.o=this.l="";this.g=!1;if(t instanceof ti){this.g=void 0!==e?e:t.g;ni(this,t.j);this.s=t.s;ri(this,t.i);ii(this,t.m);this.l=t.l;e=t.h;var n=new vi;n.i=e.i;e.g&&(n.g=new Xr(e.g),n.h=e.h);si(this,n);this.o=t.o}else t&&(n=String(t).match(Jr))?(this.g=!!e,ni(this,n[1]||"",!0),this.s=hi(n[2]||""),ri(this,n[3]||"",!0),ii(this,n[4]),this.l=hi(n[5]||"",!0),si(this,n[6]||"",!0),this.o=hi(n[7]||"")):(this.g=!!e,this.h=new vi(null,this.g))}ti.prototype.toString=function(){var t=[],e=this.j;e&&t.push(li(e,di,!0),":");var n=this.i;if(n||"file"==e)t.push("//"),(e=this.s)&&t.push(li(e,di,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,null!=n&&t.push(":",String(n));if(n=this.l)this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(li(n,"/"==n.charAt(0)?gi:pi,!0));(n=this.h.toString())&&t.push("?",n);(n=this.o)&&t.push("#",li(n,yi));return t.join("")};function ei(t){return new ti(t)}function ni(t,e,n){t.j=n?hi(e,!0):e;t.j&&(t.j=t.j.replace(/:$/,""))}function ri(t,e,n){t.i=n?hi(e,!0):e}function ii(t,e){if(e){e=Number(e);if(isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function si(t,e,n){e instanceof vi?(t.h=e,Si(t.h,t.g)):(n||(e=li(e,mi)),t.h=new vi(e,t.g))}function oi(t,e,n){t.h.set(e,n)}function ai(t){oi(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36));return t}function ci(t){return t instanceof ti?ei(t):new ti(t,void 0)}function ui(t,e,n,r){var i=new ti(null,void 0);t&&ni(i,t);e&&ri(i,e);n&&ii(i,n);r&&(i.l=r);return i}function hi(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function li(t,e,n){return"string"===typeof t?(t=encodeURI(t).replace(e,fi),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function fi(t){t=t.charCodeAt(0);return"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var di=/[#\/\?@]/g,pi=/[#\?:]/g,gi=/[#\?]/g,mi=/[#\?@]/g,yi=/#/g;function vi(t,e){this.h=this.g=null;this.i=t||null;this.j=!!e}function wi(t){t.g||(t.g=new Xr,t.h=0,t.i&&Zr(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}ge=vi.prototype;ge.add=function(t,e){wi(this);this.i=null;t=Ti(this,t);var n=this.g.get(t);n||this.g.set(t,n=[]);n.push(e);this.h+=1;return this};function bi(t,e){wi(t);e=Ti(t,e);Yr(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,t=t.g,Yr(t.h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Wr(t)))}function Ii(t,e){wi(t);e=Ti(t,e);return Yr(t.g.h,e)}ge.forEach=function(t,e){wi(this);this.g.forEach((function(n,r){ke(n,(function(n){t.call(e,n,r,this)}),this)}),this)};ge.T=function(){wi(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],s=0;s<i.length;s++)n.push(e[r]);return n};ge.R=function(t){wi(this);var e=[];if("string"===typeof t)Ii(this,t)&&(e=Le(e,this.g.get(Ti(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=Le(e,t[n])}return e};ge.set=function(t,e){wi(this);this.i=null;t=Ti(this,t);Ii(this,t)&&(this.h-=this.g.get(t).length);this.g.set(t,[e]);this.h+=1;return this};ge.get=function(t,e){if(!t)return e;t=this.R(t);return 0<t.length?String(t[0]):e};function Ei(t,e,n){bi(t,e);0<n.length&&(t.i=null,t.g.set(Ti(t,e),Pe(n)),t.h+=n.length)}ge.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s])));t.push(o)}}return this.i=t.join("&")};function Ti(t,e){e=String(e);t.j&&(e=e.toLowerCase());return e}function Si(t,e){e&&!t.j&&(wi(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(bi(this,e),Ei(this,n,t))}),t));t.j=e}var _i=function(){function t(t,e){this.h=t;this.g=e}return t}();function Ai(t){this.l=t||Ni;ye.PerformanceNavigationTiming?(t=ye.performance.getEntriesByType("navigation"),t=0<t.length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol)):t=!!(ye.g&&ye.g.Ea&&ye.g.Ea()&&ye.g.Ea().Zb);this.j=t?this.l:1;this.g=null;1<this.j&&(this.g=new Set);this.h=null;this.i=[]}var Ni=10;function xi(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function Di(t){return t.h?1:t.g?t.g.size:0}function Ri(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function Ci(t,e){t.g?t.g.add(e):t.h=e}function ki(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}Ai.prototype.cancel=function(){var t,e;this.i=Oi(this);if(this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=de(this.g.values()),r=n.next();!r.done;r=n.next()){var i=r.value;i.cancel()}}catch(e){t={error:e}}finally{try{if(r&&!r.done&&(e=n.return))e.call(n)}finally{if(t)throw t.error}}this.g.clear()}};function Oi(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=de(t.g.values()),s=i.next();!s.done;s=i.next()){var o=s.value;r=r.concat(o.D)}}catch(t){e={error:t}}finally{try{if(s&&!s.done&&(n=i.return))n.call(i)}finally{if(e)throw e.error}}return r}return Pe(t.i)}function Li(){}Li.prototype.stringify=function(t){return ye.JSON.stringify(t,void 0)};Li.prototype.parse=function(t){return ye.JSON.parse(t,void 0)};function Pi(){this.g=new Li}function Mi(t,e,n){var r=n||"";try{Qr(t,(function(t,n){var i=t;be(t)&&(i=Un(t));e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Fi(t,e){var n=new or;if(ye.Image){var r=new Image;r.onload=Ne(Vi,n,r,"TestLoadImage: loaded",!0,e);r.onerror=Ne(Vi,n,r,"TestLoadImage: error",!1,e);r.onabort=Ne(Vi,n,r,"TestLoadImage: abort",!1,e);r.ontimeout=Ne(Vi,n,r,"TestLoadImage: timeout",!1,e);ye.setTimeout((function(){if(r.ontimeout)r.ontimeout()}),1e4);r.src=t}else e(!1)}function Vi(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function Ui(t){this.l=t.$b||null;this.j=t.ib||!1}xe(Ui,Tr);Ui.prototype.g=function(){return new Bi(this.l,this.j)};Ui.prototype.i=function(t){return function(){return t}}({});function Bi(t,e){Mn.call(this);this.D=t;this.u=e;this.m=void 0;this.readyState=qi;this.status=0;this.responseType=this.responseText=this.response=this.statusText="";this.onreadystatechange=null;this.v=new Headers;this.h=null;this.C="GET";this.B="";this.g=!1;this.A=this.j=this.l=null}xe(Bi,Mn);var qi=0;ge=Bi.prototype;ge.open=function(t,e){if(this.readyState!=qi)throw this.abort(),Error("Error reopening a connection");this.C=t;this.B=e;this.readyState=1;Ki(this)};ge.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t);(this.D||ye).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))};ge.abort=function(){this.response=this.responseText="";this.v=new Headers;this.status=0;this.j&&this.j.cancel("Request was aborted.");1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,$i(this));this.readyState=qi};ge.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Ki(this)),this.g&&(this.readyState=3,Ki(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if("undefined"!==typeof ye.ReadableStream&&"body"in t){this.j=t.body.getReader();if(this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ji(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))};function ji(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}ge.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);if(e=this.A.decode(e,{stream:!t.done}))this.response=this.responseText+=e}t.done?$i(this):Ki(this);3==this.readyState&&ji(this)}};ge.Ua=function(t){this.g&&(this.response=this.responseText=t,$i(this))};ge.Ta=function(t){this.g&&(this.response=t,$i(this))};ge.ha=function(){this.g&&$i(this)};function $i(t){t.readyState=4;t.l=null;t.j=null;t.A=null;Ki(t)}ge.setRequestHeader=function(t,e){this.v.append(t,e)};ge.getResponseHeader=function(t){return this.h?this.h.get(t.toLowerCase())||"":""};ge.getAllResponseHeaders=function(){if(!this.h)return"";var t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")};function Ki(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(Bi.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var zi=ye.JSON.parse;function Hi(t){Mn.call(this);this.headers=new Xr;this.u=t||null;this.h=!1;this.C=this.g=null;this.H="";this.m=0;this.j="";this.l=this.F=this.v=this.D=!1;this.B=0;this.A=null;this.J=Gi;this.K=this.L=!1}xe(Hi,Mn);var Gi="",Qi=/^https?$/i,Xi=["POST","PUT"];ge=Hi.prototype;ge.ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET";this.H=t;this.j="";this.m=0;this.D=!1;this.h=!0;this.g=this.u?this.u.g():Dr.g();this.C=this.u?Sr(this.u):Sr(Dr);this.g.onreadystatechange=Ae(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){Ji(this,t);return}t=n||"";var i=new Xr(this.headers);r&&Qr(r,(function(t,e){i.set(e,t)}));r=Oe(i.T());n=ye.FormData&&t instanceof ye.FormData;!(0<=Ce(Xi,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");i.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this);this.J&&(this.g.responseType=this.J);"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ns(this),0<this.B&&((this.K=Wi(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ae(this.pa,this)):this.A=Zn(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Ji(this,t)}};function Wi(t){return We&&cn()&&"number"===typeof t.timeout&&void 0!==t.ontimeout}function Yi(t){return"content-type"==t.toLowerCase()}ge.pa=function(){"undefined"!=typeof me&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Fn(this,"timeout"),this.abort(8))};function Ji(t,e){t.h=!1;t.g&&(t.l=!0,t.g.abort(),t.l=!1);t.j=e;t.m=5;Zi(t);es(t)}function Zi(t){t.D||(t.D=!0,Fn(t,"complete"),Fn(t,"error"))}ge.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Fn(this,"complete"),Fn(this,"abort"),es(this))};ge.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),es(this,!0));Hi.Z.M.call(this)};ge.Fa=function(){this.s||(this.F||this.v||this.l?ts(this):this.cb())};ge.cb=function(){ts(this)};function ts(t){if(t.h&&"undefined"!=typeof me&&(!t.C[1]||4!=rs(t)||2!=t.ba()))if(t.v&&4==rs(t))Zn(t.Fa,0,t);else if(Fn(t,"readystatechange"),4==rs(t)){t.h=!1;try{var e=t.ba();t:switch(e){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var n=!0;break t;default:n=!1}var r;if(!(r=n)){var i;if(i=0===e){var s=String(t.H).match(Jr)[1]||null;if(!s&&ye.self&&ye.self.location){var o=ye.self.location.protocol;s=o.substr(0,o.length-1)}i=!Qi.test(s?s.toLowerCase():"")}r=i}if(r)Fn(t,"complete"),Fn(t,"success");else{t.m=6;try{var a=2<rs(t)?t.g.statusText:""}catch(t){a=""}t.j=a+" ["+t.ba()+"]";Zi(t)}}finally{es(t)}}}function es(t,e){if(t.g){ns(t);var n=t.g,r=t.C[0]?ve:null;t.g=null;t.C=null;e||Fn(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function ns(t){t.g&&t.K&&(t.g.ontimeout=null);t.A&&(ye.clearTimeout(t.A),t.A=null)}function rs(t){return t.g?t.g.readyState:0}ge.ba=function(){try{return 2<rs(this)?this.g.status:-1}catch(t){return-1}};ge.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}};ge.Qa=function(t){if(this.g){var e=this.g.responseText;t&&0==e.indexOf(t)&&(e=e.substring(t.length));return zi(e)}};function is(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Gi:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}ge.Da=function(){return this.m};ge.La=function(){return"string"===typeof this.j?this.j:String(this.j)};function ss(t){var e="";$e(t,(function(t,n){e+=n;e+=":";e+=t;e+="\r\n"}));return e}function os(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=ss(n),"string"===typeof t?null!=n&&encodeURIComponent(String(n)):oi(t,e,n))}function as(t,e,n){return n&&n.internalChannelParams?n.internalChannelParams[t]||e:e}function cs(t){this.za=0;this.l=[];this.h=new or;this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null;this.Za=this.V=0;this.Xa=as("failFast",!1,t);this.N=this.v=this.u=this.m=this.j=null;this.X=!0;this.I=this.ta=this.U=-1;this.Y=this.A=this.C=0;this.Pa=as("baseRetryDelayMs",5e3,t);this.$a=as("retryDelaySeedMs",1e4,t);this.Ya=as("forwardChannelMaxRetries",2,t);this.ra=as("forwardChannelRequestTimeoutMs",2e4,t);this.qa=t&&t.xmlHttpFactory||void 0;this.Ba=t&&t.Yb||!1;this.K=void 0;this.H=t&&t.supportsCrossDomainXhr||!1;this.J="";this.i=new Ai(t&&t.concurrentRequestLimit);this.Ca=new Pi;this.ja=t&&t.fastHandshake||!1;this.Ra=t&&t.Wb||!1;t&&t.Aa&&this.h.Aa();t&&t.forceLongPolling&&(this.X=!1);this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1;this.ka=void 0;this.O=0;this.L=!1;this.B=null;this.Wa=!t||!1!==t.Xb}ge=cs.prototype;ge.ma=8;ge.G=1;function us(t){ls(t);if(3==t.G){var e=t.V++,n=ei(t.F);oi(n,"SID",t.J);oi(n,"RID",e);oi(n,"TYPE","terminate");ms(t,n);e=new Cr(t,t.h,e,void 0);e.K=2;e.v=ai(ei(n));n=!1;ye.navigator&&ye.navigator.sendBeacon&&(n=ye.navigator.sendBeacon(e.v.toString(),""));!n&&ye.Image&&((new Image).src=e.v,n=!0);n||(e.g=xs(e.l,null),e.g.ea(e.v));e.F=Date.now();qr(e)}As(t)}ge.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}};function hs(t){t.g&&(bs(t),t.g.cancel(),t.g=null)}function ls(t){hs(t);t.u&&(ye.clearTimeout(t.u),t.u=null);Es(t);t.i.cancel();t.m&&("number"===typeof t.m&&ye.clearTimeout(t.m),t.m=null)}function fs(t,e){t.l.push(new _i(t.Za++,e));3==t.G&&ds(t)}function ds(t){xi(t.i)||t.m||(t.m=!0,zn(t.Ha,t),t.C=0)}function ps(t,e){if(Di(t.i)>=t.i.j-(t.m?1:0))return!1;if(t.m)return t.l=e.D.concat(t.l),!0;if(1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya))return!1;t.m=br(Ae(t.Ha,t,e),Ss(t,t.C));t.C++;return!0}ge.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random());t=this.V++;var e=new Cr(this,this.h,t,void 0);var n=this.s;this.P&&(n?(n=Ke(n),He(n,this.P)):n=this.P);null===this.o&&(e.H=n);if(this.ja)t:{var r=0;for(var i=0;i<this.l.length;i++){e:{var s=this.l[i];if("__data__"in s.g&&(s=s.g.__data__,"string"===typeof s)){s=s.length;break e}s=void 0}if(void 0===s)break;r+=s;if(4096<r){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=ys(this,e,r);i=ei(this.F);oi(i,"RID",t);oi(i,"CVER",22);this.D&&oi(i,"X-HTTP-Session-Id",this.D);ms(this,i);this.o&&n&&os(i,this.o,n);Ci(this.i,e);this.Ra&&oi(i,"TYPE","init");this.ja?(oi(i,"$req",r),oi(i,"SID","null"),e.$=!0,Mr(e,i,null)):Mr(e,i,r);this.G=2}}else 3==this.G&&(t?gs(this,t):0==this.l.length||xi(this.i)||gs(this))};function gs(t,e){var n;e?n=e.m:n=t.V++;var r=ei(t.F);oi(r,"SID",t.J);oi(r,"RID",n);oi(r,"AID",t.U);ms(t,r);t.o&&t.s&&os(r,t.o,t.s);n=new Cr(t,t.h,n,t.C+1);null===t.o&&(n.H=t.s);e&&(t.l=e.D.concat(t.l));e=ys(t,n,1e3);n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random()));Ci(t.i,n);Mr(n,r,e)}function ms(t,e){t.j&&Qr({},(function(t,n){oi(e,n,t)}))}function ys(t,e,n){n=Math.min(t.l.length,n);var r=t.j?Ae(t.j.Oa,t.j,t):null;t:{var i=t.l;var s=-1;for(;;){var o=["count="+n];-1==s?0<n?(s=i[0].h,o.push("ofs="+s)):s=0:o.push("ofs="+s);var a=!0;for(var c=0;c<n;c++){var u=i[c].h;var h=i[c].g;u-=s;if(0>u)s=Math.max(0,i[c].h-100),a=!1;else try{Mi(h,o,"req"+u+"_")}catch(t){r&&r(h)}}if(a){r=o.join("&");break t}}}t=t.l.splice(0,n);e.D=t;return r}function vs(t){t.g||t.u||(t.Y=1,zn(t.Ga,t),t.A=0)}function ws(t){if(t.g||t.u||3<=t.A)return!1;t.Y++;t.u=br(Ae(t.Ga,t),Ss(t,t.A));t.A++;return!0}ge.Ga=function(){this.u=null;Is(this);if(this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t);this.B=br(Ae(this.bb,this),t)}};ge.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,vr(10),hs(this),Is(this))};function bs(t){null!=t.B&&(ye.clearTimeout(t.B),t.B=null)}function Is(t){t.g=new Cr(t,t.h,"rpc",t.Y);null===t.o&&(t.g.H=t.s);t.g.O=0;var e=ei(t.oa);oi(e,"RID","rpc");oi(e,"SID",t.J);oi(e,"CI",t.N?"0":"1");oi(e,"AID",t.U);ms(t,e);oi(e,"TYPE","xmlhttp");t.o&&t.s&&os(e,t.o,t.s);t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la;n.K=1;n.v=ai(ei(e));n.s=null;n.U=!0;Fr(n,t)}ge.ab=function(){null!=this.v&&(this.v=null,hs(this),ws(this),vr(19))};function Es(t){null!=t.v&&(ye.clearTimeout(t.v),t.v=null)}function Ts(t,e){var n=null;if(t.g==e){Es(t);bs(t);t.g=null;var r=2}else if(Ri(t.i,e))n=e.D,ki(t.i,e),r=1;else return;t.I=e.N;if(0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0;e=Date.now()-e.F;var i=t.C;r=pr();Fn(r,new wr(r,n,e,i));ds(t)}else vs(t);else if(i=e.o,3==i||0==i&&0<t.I||!(1==r&&ps(t,e)||2==r&&ws(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:_s(t,5);break;case 4:_s(t,10);break;case 3:_s(t,6);break;default:_s(t,2)}}function Ss(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);t.j||(n*=2);return n*e}function _s(t,e){t.h.info("Error code "+e);if(2==e){var n=null;t.j&&(n=null);var r=Ae(t.jb,t);n||(n=new ti("//www.google.com/images/cleardot.gif"),ye.location&&"http"==ye.location.protocol||ni(n,"https"),ai(n));Fi(n.toString(),r)}else vr(2);t.G=0;t.j&&t.j.va(e);As(t);ls(t)}ge.jb=function(t){t?(this.h.info("Successfully pinged google.com"),vr(2)):(this.h.info("Failed to ping google.com"),vr(1))};function As(t){t.G=0;t.I=-1;if(t.j){if(0!=Oi(t.i).length||0!=t.l.length)t.i.i.length=0,Pe(t.l),t.l.length=0;t.j.ua()}}function Ns(t,e,n){var r=ci(n);if(""!=r.i)e&&ri(r,e+"."+r.i),ii(r,r.m);else{var i=ye.location;r=ui(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}t.aa&&$e(t.aa,(function(t,e){oi(r,e,t)}));e=t.D;n=t.sa;e&&n&&oi(r,e,n);oi(r,"VER",t.ma);ms(t,r);return r}function xs(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");e=n&&t.Ba&&!t.qa?new Hi(new Ui({ib:!0})):new Hi(t.qa);e.L=t.H;return e}function Ds(){}ge=Ds.prototype;ge.xa=function(){};ge.wa=function(){};ge.va=function(){};ge.ua=function(){};ge.Oa=function(){};function Rs(){if(We&&!(10<=Number(ln)))throw Error("Environmental error: no available transport.")}Rs.prototype.g=function(t,e){return new Cs(t,e)};function Cs(t,e){Mn.call(this);this.g=new cs(e);this.l=t;this.h=e&&e.messageUrlParams||null;t=e&&e.messageHeaders||null;e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"});this.g.s=t;t=e&&e.initMessageHeaders||null;e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType});e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya});this.g.P=t;(t=e&&e.httpHeadersOverwriteParam)&&!Me(t)&&(this.g.o=t);this.A=e&&e.supportsCrossDomainXhr||!1;this.v=e&&e.sendRawJson||!1;(e=e&&e.httpSessionIdParam)&&!Me(e)&&(this.g.D=e,t=this.h,null!==t&&e in t&&(t=this.h,e in t&&delete t[e]));this.j=new Ls(this)}xe(Cs,Mn);Cs.prototype.m=function(){this.g.j=this.j;this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),zn(Ae(t.hb,t,e)));vr(0);t.W=e;t.aa=n||{};t.N=t.X;t.F=Ns(t,null,t.W);ds(t)};Cs.prototype.close=function(){us(this.g)};Cs.prototype.u=function(t){if("string"===typeof t){var e={};e.__data__=t;fs(this.g,e)}else this.v?(e={},e.__data__=Un(t),fs(this.g,e)):fs(this.g,t)};Cs.prototype.M=function(){this.g.j=null;delete this.j;us(this.g);delete this.g;Cs.Z.M.call(this)};function ks(t){Nr.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}if(this.i=t)t=this.i,e=null!==e&&t in e?e[t]:void 0;this.data=e}else this.data=t}xe(ks,Nr);function Os(){xr.call(this);this.status=1}xe(Os,xr);function Ls(t){this.g=t}xe(Ls,Ds);Ls.prototype.xa=function(){Fn(this.g,"a")};Ls.prototype.wa=function(t){Fn(this.g,new ks(t))};Ls.prototype.va=function(t){Fn(this.g,new Os(t))};Ls.prototype.ua=function(){Fn(this.g,"b")};Rs.prototype.createWebChannel=Rs.prototype.g;Cs.prototype.send=Cs.prototype.u;Cs.prototype.open=Cs.prototype.m;Cs.prototype.close=Cs.prototype.close;Ir.NO_ERROR=0;Ir.TIMEOUT=8;Ir.HTTP_ERROR=6;Er.COMPLETE="complete";_r.EventType=Ar;Ar.OPEN="a";Ar.CLOSE="b";Ar.ERROR="c";Ar.MESSAGE="d";Mn.prototype.listen=Mn.prototype.N;Hi.prototype.listenOnce=Hi.prototype.O;Hi.prototype.getLastError=Hi.prototype.La;Hi.prototype.getLastErrorCode=Hi.prototype.Da;Hi.prototype.getStatus=Hi.prototype.ba;Hi.prototype.getResponseJson=Hi.prototype.Qa;Hi.prototype.getResponseText=Hi.prototype.ga;Hi.prototype.send=Hi.prototype.ea;var Ps=function(){return new Rs};var Ms=function(){return pr()};var Fs=Ir;var Vs=Er;var Us=fr;var Bs={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20};var qs=Ui;var js=_r;var $s=Hi;let Ks="8.6.8";class zs{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.t(t),this.i=t=>e.writeSequenceNumber(t))}t(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.i&&this.i(t),t}}zs.o=-1;const Hs={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Gs extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}const Qs=new L("@firebase/firestore");function Xs(){return Qs.logLevel}function Ws(t){Qs.setLogLevel(t)}function Ys(t,...e){if(Qs.logLevel<=D.DEBUG){const n=e.map(to);Qs.debug(`Firestore (${Ks}): ${t}`,...n)}}function Js(t,...e){if(Qs.logLevel<=D.ERROR){const n=e.map(to);Qs.error(`Firestore (${Ks}): ${t}`,...n)}}function Zs(t,...e){if(Qs.logLevel<=D.WARN){const n=e.map(to);Qs.warn(`Firestore (${Ks}): ${t}`,...n)}}function to(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function eo(t="Unexpected state"){const e=`FIRESTORE (${Ks}) INTERNAL ASSERTION FAILED: `+t;throw Js(e),new Error(e)}function no(t,e){t||eo()}function ro(t,e){return t}function io(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class so{static u(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const r=io(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length))}return n}}function oo(t,e){return t<e?-1:t>e?1:0}function ao(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}function co(t){return t+"\0"}class uo{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Gs(Hs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Gs(Hs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Gs(Hs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Gs(Hs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return uo.fromMillis(Date.now())}static fromDate(t){return uo.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new uo(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?oo(this.nanoseconds,t.nanoseconds):oo(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ho{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ho(t)}static min(){return new ho(new uo(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function lo(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function fo(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function po(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class go{constructor(t,e,n){void 0===e?e=0:e>t.length&&eo(),void 0===n?n=t.length-e:n>t.length-e&&eo(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===go.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof go?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),i=e.get(r);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class mo extends go{construct(t,e,n){return new mo(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Gs(Hs.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new mo(e)}static emptyPath(){return new mo([])}}const yo=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class vo extends go{construct(t,e,n){return new vo(t,e,n)}static isValidIdentifier(t){return yo.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),vo.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new vo(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Gs(Hs.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Gs(Hs.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Gs(Hs.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new Gs(Hs.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new vo(e)}static emptyPath(){return new vo([])}}class wo{constructor(t){this.fields=t,t.sort(vo.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return ao(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class bo{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new bo(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new bo(e)}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return oo(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}bo.EMPTY_BYTE_STRING=new bo("");const Io=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Eo(t){if(no(!!t),"string"==typeof t){let e=0;const n=Io.exec(t);if(no(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:To(t.seconds),nanos:To(t.nanos)}}function To(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function So(t){return"string"==typeof t?bo.fromBase64String(t):bo.fromUint8Array(t)}function _o(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ao(t){const e=Eo(t.mapValue.fields.__local_write_time__.timestampValue);return new uo(e.seconds,e.nanos)}function No(t){return null==t}function xo(t){return 0===t&&1/t==-1/0}function Do(t){return"number"==typeof t&&Number.isInteger(t)&&!xo(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class Ro{constructor(t){this.path=t}static fromPath(t){return new Ro(mo.fromString(t))}static fromName(t){return new Ro(mo.fromString(t).popFirst(5))}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===mo.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return mo.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Ro(new mo(t.slice()))}}function Co(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?_o(t)?4:10:eo()}function ko(t,e){const n=Co(t);if(n!==Co(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ao(t).isEqual(Ao(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Eo(t.timestampValue),r=Eo(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return So(t.bytesValue).isEqual(So(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return To(t.geoPointValue.latitude)===To(e.geoPointValue.latitude)&&To(t.geoPointValue.longitude)===To(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return To(t.integerValue)===To(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=To(t.doubleValue),r=To(e.doubleValue);return n===r?xo(n)===xo(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return ao(t.arrayValue.values||[],e.arrayValue.values||[],ko);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(lo(n)!==lo(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!ko(n[t],r[t])))return!1;return!0}(t,e);default:return eo()}}function Oo(t,e){return void 0!==(t.values||[]).find((t=>ko(t,e)))}function Lo(t,e){const n=Co(t),r=Co(e);if(n!==r)return oo(n,r);switch(n){case 0:return 0;case 1:return oo(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=To(t.integerValue||t.doubleValue),r=To(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Po(t.timestampValue,e.timestampValue);case 4:return Po(Ao(t),Ao(e));case 5:return oo(t.stringValue,e.stringValue);case 6:return function(t,e){const n=So(t),r=So(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=oo(n[t],r[t]);if(0!==e)return e}return oo(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=oo(To(t.latitude),To(e.latitude));if(0!==n)return n;return oo(To(t.longitude),To(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=Lo(n[t],r[t]);if(e)return e}return oo(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=oo(r[t],s[t]);if(0!==e)return e;const o=Lo(n[r[t]],i[s[t]]);if(0!==o)return o}return oo(r.length,s.length)}(t.mapValue,e.mapValue);default:throw eo()}}function Po(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return oo(t,e);const n=Eo(t),r=Eo(e),i=oo(n.seconds,r.seconds);return 0!==i?i:oo(n.nanos,r.nanos)}function Mo(t){return Fo(t)}function Fo(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Eo(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?So(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,Ro.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Fo(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${Fo(t.fields[i])}`;return n+"}"}(t.mapValue):eo();var e,n}function Vo(t){return!!t&&"integerValue"in t}function Uo(t){return!!t&&"arrayValue"in t}function Bo(t){return!!t&&"nullValue"in t}function qo(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function jo(t){return!!t&&"mapValue"in t}function $o(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue)return{timestampValue:Object.assign({},Eo(t.timestampValue))};if(t.mapValue){const e={mapValue:{fields:{}}};return fo(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=$o(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=$o(t.arrayValue.values[n]);return e}return Object.assign({},t)}class Ko{constructor(t){this.value=t}static empty(){return new Ko({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!jo(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=$o(e)}setAll(t){let e=vo.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=$o(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());jo(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ko(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];jo(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){fo(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Ko($o(this.value))}}function zo(t){const e=[];return fo(t.fields,((t,n)=>{const r=new vo([t]);if(jo(n)){const t=zo(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new wo(e)}class Ho{constructor(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}static newInvalidDocument(t){return new Ho(t,0,ho.min(),Ko.empty(),0)}static newFoundDocument(t,e,n){return new Ho(t,1,e,n,0)}static newNoDocument(t,e){return new Ho(t,2,e,Ko.empty(),0)}static newUnknownDocument(t,e){return new Ho(t,3,e,Ko.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ko.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ko.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Ho&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}clone(){return new Ho(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Go{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.h=null}}function Qo(t,e=null,n=[],r=[],i=null,s=null,o=null){return new Go(t,e,n,r,i,s,o)}function Xo(t){const e=ro(t);if(null===e.h){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>ta(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),No(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=ha(e.startAt)),e.endAt&&(t+="|ub:",t+=ha(e.endAt)),e.h=t}return e.h}function Wo(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${Mo(e.value)}`;var e})).join(", ")}]`),No(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: "+ha(t.startAt)),t.endAt&&(e+=", endAt: "+ha(t.endAt)),`Target(${e})`}function Yo(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!fa(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],r=e.filters[i],n.op!==r.op||!n.field.isEqual(r.field)||!ko(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&(!!t.path.isEqual(e.path)&&(!!pa(t.startAt,e.startAt)&&pa(t.endAt,e.endAt)))}function Jo(t){return Ro.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Zo extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new ea(t,e,n):"array-contains"===e?new sa(t,n):"in"===e?new oa(t,n):"not-in"===e?new aa(t,n):"array-contains-any"===e?new ca(t,n):new Zo(t,e,n)}static l(t,e,n){return"in"===e?new na(t,n):new ra(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Lo(e,this.value)):null!==e&&Co(this.value)===Co(e)&&this.m(Lo(e,this.value))}m(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return eo()}}g(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}function ta(t){return t.field.canonicalString()+t.op.toString()+Mo(t.value)}class ea extends Zo{constructor(t,e,n){super(t,e,n),this.key=Ro.fromName(n.referenceValue)}matches(t){const e=Ro.comparator(t.key,this.key);return this.m(e)}}class na extends Zo{constructor(t,e){super(t,"in",e),this.keys=ia("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class ra extends Zo{constructor(t,e){super(t,"not-in",e),this.keys=ia("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function ia(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>Ro.fromName(t.referenceValue)))}class sa extends Zo{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Uo(e)&&Oo(e.arrayValue,this.value)}}class oa extends Zo{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Oo(this.value.arrayValue,e)}}class aa extends Zo{constructor(t,e){super(t,"not-in",e)}matches(t){if(Oo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Oo(this.value.arrayValue,e)}}class ca extends Zo{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Uo(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Oo(this.value.arrayValue,t)))}}class ua{constructor(t,e){this.position=t,this.before=e}}function ha(t){return`${t.before?"b":"a"}:${t.position.map((t=>Mo(t))).join(",")}`}class la{constructor(t,e="asc"){this.field=t,this.dir=e}}function fa(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function da(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(s.field.isKeyField())r=Ro.comparator(Ro.fromName(o.referenceValue),n.key);else{r=Lo(o,n.data.field(s.field))}if("desc"===s.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function pa(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++){if(!ko(t.position[n],e.position[n]))return!1}return!0}class ga{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt}}function ma(t,e,n,r,i,s,o,a){return new ga(t,e,n,r,i,s,o,a)}function ya(t){return new ga(t)}function va(t){return!No(t.limit)&&"F"===t.limitType}function wa(t){return!No(t.limit)&&"L"===t.limitType}function ba(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Ia(t){for(const e of t.filters)if(e.g())return e.field;return null}function Ea(t){return null!==t.collectionGroup}function Ta(t){const e=ro(t);if(null===e.p){e.p=[];const t=Ia(e),n=ba(e);if(null!==t&&null===n)t.isKeyField()||e.p.push(new la(t)),e.p.push(new la(vo.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.p.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new la(vo.keyField(),t))}}}return e.p}function Sa(t){const e=ro(t);if(!e.T)if("F"===e.limitType)e.T=Qo(e.path,e.collectionGroup,Ta(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Ta(e)){const e="desc"===n.dir?"asc":"desc";t.push(new la(n.field,e))}const n=e.endAt?new ua(e.endAt.position,!e.endAt.before):null,r=e.startAt?new ua(e.startAt.position,!e.startAt.before):null;e.T=Qo(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e.T}function _a(t,e,n){return new ga(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Aa(t,e){return Yo(Sa(t),Sa(e))&&t.limitType===e.limitType}function Na(t){return`${Xo(Sa(t))}|lt:${t.limitType}`}function xa(t){return`Query(target=${Wo(Sa(t))}; limitType=${t.limitType})`}function Da(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Ro.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){if(t.startAt&&!da(t.startAt,Ta(t),e))return!1;if(t.endAt&&da(t.endAt,Ta(t),e))return!1;return!0}(t,e)}function Ra(t){return(e,n)=>{let r=!1;for(const i of Ta(t)){const t=Ca(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function Ca(t,e,n){const r=t.field.isKeyField()?Ro.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Lo(r,i):eo()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return eo()}}function ka(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xo(e)?"-0":e}}function Oa(t){return{integerValue:""+t}}function La(t,e){return Do(e)?Oa(e):ka(t,e)}class Pa{constructor(){this._=void 0}}function Ma(t,e,n){return t instanceof Ua?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ba?qa(t,e):t instanceof ja?$a(t,e):function(t,e){const n=Va(t,e),r=za(n)+za(t.A);return Vo(n)&&Vo(t.A)?Oa(r):ka(t.R,r)}(t,e)}function Fa(t,e,n){return t instanceof Ba?qa(t,e):t instanceof ja?$a(t,e):n}function Va(t,e){return t instanceof Ka?Vo(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class Ua extends Pa{}class Ba extends Pa{constructor(t){super(),this.elements=t}}function qa(t,e){const n=Ha(e);for(const e of t.elements)n.some((t=>ko(t,e)))||n.push(e);return{arrayValue:{values:n}}}class ja extends Pa{constructor(t){super(),this.elements=t}}function $a(t,e){let n=Ha(e);for(const e of t.elements)n=n.filter((t=>!ko(t,e)));return{arrayValue:{values:n}}}class Ka extends Pa{constructor(t,e){super(),this.R=t,this.A=e}}function za(t){return To(t.integerValue||t.doubleValue)}function Ha(t){return Uo(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Ga{constructor(t,e){this.field=t,this.transform=e}}function Qa(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ba&&e instanceof Ba||t instanceof ja&&e instanceof ja?ao(t.elements,e.elements,ko):t instanceof Ka&&e instanceof Ka?ko(t.A,e.A):t instanceof Ua&&e instanceof Ua}(t.transform,e.transform)}class Xa{constructor(t,e){this.version=t,this.transformResults=e}}class Wa{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Wa}static exists(t){return new Wa(void 0,t)}static updateTime(t){return new Wa(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ya(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Ja{}function Za(t,e,n){t instanceof ic?function(t,e,n){const r=t.value.clone(),i=ac(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof sc?function(t,e,n){if(!Ya(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=ac(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(oc(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function tc(t,e,n){t instanceof ic?function(t,e,n){if(!Ya(t.precondition,e))return;const r=t.value.clone(),i=cc(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(rc(e),r).setHasLocalMutations()}(t,e,n):t instanceof sc?function(t,e,n){if(!Ya(t.precondition,e))return;const r=cc(t.fieldTransforms,n,e),i=e.data;i.setAll(oc(t)),i.setAll(r),e.convertToFoundDocument(rc(e),i).setHasLocalMutations()}(t,e,n):function(t,e){Ya(t.precondition,e)&&e.convertToNoDocument(ho.min())}(t,e)}function ec(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),i=Va(r.transform,t||null);null!=i&&(null==n&&(n=Ko.empty()),n.set(r.field,i))}return n||null}function nc(t,e){return t.type===e.type&&(!!t.key.isEqual(e.key)&&(!!t.precondition.isEqual(e.precondition)&&(!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&ao(t,e,((t,e)=>Qa(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask)))))}function rc(t){return t.isFoundDocument()?t.version:ho.min()}class ic extends Ja{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}}class sc extends Ja{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function oc(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function ac(t,e,n){const r=new Map;no(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,Fa(o,a,n[i]))}return r}function cc(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,Ma(t,s,e))}return r}class uc extends Ja{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class hc extends Ja{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}var lc,fc;function dc(t){switch(t){case Hs.OK:return eo();case Hs.CANCELLED:case Hs.UNKNOWN:case Hs.DEADLINE_EXCEEDED:case Hs.RESOURCE_EXHAUSTED:case Hs.INTERNAL:case Hs.UNAVAILABLE:case Hs.UNAUTHENTICATED:return!1;case Hs.INVALID_ARGUMENT:case Hs.NOT_FOUND:case Hs.ALREADY_EXISTS:case Hs.PERMISSION_DENIED:case Hs.FAILED_PRECONDITION:case Hs.ABORTED:case Hs.OUT_OF_RANGE:case Hs.UNIMPLEMENTED:case Hs.DATA_LOSS:return!0;default:return eo()}}function pc(t){if(void 0===t)return Js("GRPC error has no .code"),Hs.UNKNOWN;switch(t){case lc.OK:return Hs.OK;case lc.CANCELLED:return Hs.CANCELLED;case lc.UNKNOWN:return Hs.UNKNOWN;case lc.DEADLINE_EXCEEDED:return Hs.DEADLINE_EXCEEDED;case lc.RESOURCE_EXHAUSTED:return Hs.RESOURCE_EXHAUSTED;case lc.INTERNAL:return Hs.INTERNAL;case lc.UNAVAILABLE:return Hs.UNAVAILABLE;case lc.UNAUTHENTICATED:return Hs.UNAUTHENTICATED;case lc.INVALID_ARGUMENT:return Hs.INVALID_ARGUMENT;case lc.NOT_FOUND:return Hs.NOT_FOUND;case lc.ALREADY_EXISTS:return Hs.ALREADY_EXISTS;case lc.PERMISSION_DENIED:return Hs.PERMISSION_DENIED;case lc.FAILED_PRECONDITION:return Hs.FAILED_PRECONDITION;case lc.ABORTED:return Hs.ABORTED;case lc.OUT_OF_RANGE:return Hs.OUT_OF_RANGE;case lc.UNIMPLEMENTED:return Hs.UNIMPLEMENTED;case lc.DATA_LOSS:return Hs.DATA_LOSS;default:return eo()}}(fc=lc||(lc={}))[fc.OK=0]="OK",fc[fc.CANCELLED=1]="CANCELLED",fc[fc.UNKNOWN=2]="UNKNOWN",fc[fc.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",fc[fc.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",fc[fc.NOT_FOUND=5]="NOT_FOUND",fc[fc.ALREADY_EXISTS=6]="ALREADY_EXISTS",fc[fc.PERMISSION_DENIED=7]="PERMISSION_DENIED",fc[fc.UNAUTHENTICATED=16]="UNAUTHENTICATED",fc[fc.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",fc[fc.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",fc[fc.ABORTED=10]="ABORTED",fc[fc.OUT_OF_RANGE=11]="OUT_OF_RANGE",fc[fc.UNIMPLEMENTED=12]="UNIMPLEMENTED",fc[fc.INTERNAL=13]="INTERNAL",fc[fc.UNAVAILABLE=14]="UNAVAILABLE",fc[fc.DATA_LOSS=15]="DATA_LOSS";class gc{constructor(t,e){this.comparator=t,this.root=e||yc.EMPTY}insert(t,e){return new gc(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,yc.BLACK,null,null))}remove(t){return new gc(this.comparator,this.root.remove(t,this.comparator).copy(null,null,yc.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new mc(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new mc(this.root,t,this.comparator,!1)}getReverseIterator(){return new mc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new mc(this.root,t,this.comparator,!0)}}class mc{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class yc{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:yc.RED,this.left=null!=r?r:yc.EMPTY,this.right=null!=i?i:yc.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new yc(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return yc.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return yc.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,yc.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,yc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw eo();if(this.right.isRed())throw eo();const t=this.left.check();if(t!==this.right.check())throw eo();return t+(this.isRed()?0:1)}}yc.EMPTY=null,yc.RED=!0,yc.BLACK=!1;yc.EMPTY=new class{constructor(){this.size=0}get key(){throw eo()}get value(){throw eo()}get color(){throw eo()}get left(){throw eo()}get right(){throw eo()}copy(t,e,n,r,i){return this}insert(t,e,n){return new yc(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class vc{constructor(t){this.comparator=t,this.data=new gc(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();){if(!t(n.getNext().key))return}}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new wc(this.data.getIterator())}getIteratorFrom(t){return new wc(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof vc))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new vc(this.comparator);return e.data=t,e}}class wc{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const bc=new gc(Ro.comparator);function Ic(){return bc}const Ec=new gc(Ro.comparator);function Tc(){return Ec}const Sc=new gc(Ro.comparator);function _c(){return Sc}const Ac=new vc(Ro.comparator);function Nc(...t){let e=Ac;for(const n of t)e=e.add(n);return e}const xc=new vc(oo);function Dc(){return xc}const Rc=(()=>{const t={asc:"ASCENDING",desc:"DESCENDING"};return t})(),Cc=(()=>{const t={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};return t})();class kc{constructor(t,e){this.databaseId=t,this.I=e}}function Oc(t,e){if(t.I){return`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`}return{seconds:""+e.seconds,nanos:e.nanoseconds}}function Lc(t,e){return t.I?e.toBase64():e.toUint8Array()}function Pc(t,e){return Oc(t,e.toTimestamp())}function Mc(t){return no(!!t),ho.fromTimestamp(function(t){const e=Eo(t);return new uo(e.seconds,e.nanos)}(t))}function Fc(t,e){return function(t){return new mo(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Vc(t){const e=mo.fromString(t);return no(uu(e)),e}function Uc(t,e){return Fc(t.databaseId,e.path)}function Bc(t,e){const n=Vc(e);if(n.get(1)!==t.databaseId.projectId)throw new Gs(Hs.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Gs(Hs.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ro(Kc(n))}function qc(t,e){return Fc(t.databaseId,e)}function jc(t){const e=Vc(t);return 4===e.length?mo.emptyPath():Kc(e)}function $c(t){return new mo(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Kc(t){return no(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function zc(t,e,n){return{name:Uc(t,e),fields:n.value.mapValue.fields}}function Hc(t,e,n){const r=Bc(t,e.name),i=Mc(e.updateTime),s=new Ko({mapValue:{fields:e.fields}}),o=Ho.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Gc(t,e){let n;if(e instanceof ic)n={update:zc(t,e.key,e.value)};else if(e instanceof uc)n={delete:Uc(t,e.key)};else if(e instanceof sc)n={update:zc(t,e.key,e.data),updateMask:cu(e.fieldMask)};else{if(!(e instanceof hc))return eo();n={verify:Uc(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Ua)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ba)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ja)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ka)return{fieldPath:e.field.canonicalString(),increment:n.A};throw eo()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Pc(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:eo()}(t,e.precondition)),n}function Qc(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?Wa.updateTime(Mc(t.updateTime)):void 0!==t.exists?Wa.exists(t.exists):Wa.none()}(e.currentDocument):Wa.none(),r=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)no("REQUEST_TIME"===e.setToServerValue),n=new Ua;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Ba(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new ja(t)}else"increment"in e?n=new Ka(t,e.increment):eo();const r=vo.fromServerFormat(e.fieldPath);return new Ga(r,n)}(t,e))):[];if(e.update){e.update.name;const i=Bc(t,e.update.name),s=new Ko({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new wo(e.map((t=>vo.fromServerFormat(t))))}(e.updateMask);return new sc(i,s,t,n,r)}return new ic(i,s,n,r)}if(e.delete){const r=Bc(t,e.delete);return new uc(r,n)}if(e.verify){const r=Bc(t,e.verify);return new hc(r,n)}return eo()}function Xc(t,e){return t&&t.length>0?(no(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Mc(t.updateTime):Mc(e);return n.isEqual(ho.min())&&(n=Mc(e)),new Xa(n,t.transformResults||[])}(t,e)))):[]}function Wc(t,e){return{documents:[qc(t,e.path)]}}function Yc(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=qc(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=qc(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(qo(t.value))return{unaryFilter:{field:iu(t.field),op:"IS_NAN"}};if(Bo(t.value))return{unaryFilter:{field:iu(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(qo(t.value))return{unaryFilter:{field:iu(t.field),op:"IS_NOT_NAN"}};if(Bo(t.value))return{unaryFilter:{field:iu(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:iu(t.field),op:ru(t.op),value:t.value}}}(t)));if(1===e.length)return e[0];return{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const s=function(t){if(0===t.length)return;return t.map((t=>function(t){return{field:iu(t.field),direction:nu(t.dir)}}(t)))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(t,e){return t.I||No(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=tu(e.startAt)),e.endAt&&(n.structuredQuery.endAt=tu(e.endAt)),n}function Jc(t){let e=jc(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){no(1===r);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=Zc(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new la(su(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,No(e)?null:e}(n.limit));let c=null;n.startAt&&(c=eu(n.startAt));let u=null;return n.endAt&&(u=eu(n.endAt)),ma(e,i,o,s,a,"F",c,u)}function Zc(t){return t?void 0!==t.unaryFilter?[au(t)]:void 0!==t.fieldFilter?[ou(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>Zc(t))).reduce(((t,e)=>t.concat(e))):eo():[]}function tu(t){return{before:t.before,values:t.position}}function eu(t){const e=!!t.before,n=t.values||[];return new ua(n,e)}function nu(t){return Rc[t]}function ru(t){return Cc[t]}function iu(t){return{fieldPath:t.canonicalString()}}function su(t){return vo.fromServerFormat(t.fieldPath)}function ou(t){return Zo.create(su(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return eo()}}(t.fieldFilter.op),t.fieldFilter.value)}function au(t){switch(t.unaryFilter.op){case"IS_NAN":const e=su(t.unaryFilter.field);return Zo.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=su(t.unaryFilter.field);return Zo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=su(t.unaryFilter.field);return Zo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=su(t.unaryFilter.field);return Zo.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return eo()}}function cu(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function uu(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function hu(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=fu(e)),e=lu(t.get(n),e);return fu(e)}function lu(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function fu(t){return t+""}function du(t){const e=t.length;if(no(e>=2),2===e)return no(""===t.charAt(0)&&""===t.charAt(1)),mo.emptyPath();const n=e-2,r=[];let i="";for(let s=0;s<e;){const e=t.indexOf("",s);(e<0||e>n)&&eo();switch(t.charAt(e+1)){case"":const n=t.substring(s,e);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=t.substring(s,e),i+="\0";break;case"":i+=t.substring(s,e+1);break;default:eo()}s=e+2}return new mo(r)}class pu{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class gu{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}gu.store="owner",gu.key="owner";class mu{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}mu.store="mutationQueues",mu.keyPath="userId";class yu{constructor(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}yu.store="mutations",yu.keyPath="batchId",yu.userMutationsIndex="userMutationsIndex",yu.userMutationsKeyPath=["userId","batchId"];class vu{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,hu(e)]}static key(t,e,n){return[t,hu(e),n]}}vu.store="documentMutations",vu.PLACEHOLDER=new vu;class wu{constructor(t,e){this.path=t,this.readTime=e}}class bu{constructor(t,e){this.path=t,this.version=e}}class Iu{constructor(t,e,n,r,i,s){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}Iu.store="remoteDocuments",Iu.readTimeIndex="readTimeIndex",Iu.readTimeIndexPath="readTime",Iu.collectionReadTimeIndex="collectionReadTimeIndex",Iu.collectionReadTimeIndexPath=["parentPath","readTime"];class Eu{constructor(t){this.byteSize=t}}Eu.store="remoteDocumentGlobal",Eu.key="remoteDocumentGlobalKey";class Tu{constructor(t,e,n,r,i,s,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}Tu.store="targets",Tu.keyPath="targetId",Tu.queryTargetsIndexName="queryTargetsIndex",Tu.queryTargetsKeyPath=["canonicalId","targetId"];class Su{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}Su.store="targetDocuments",Su.keyPath=["targetId","path"],Su.documentTargetsIndex="documentTargetsIndex",Su.documentTargetsKeyPath=["path","targetId"];class _u{constructor(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}_u.key="targetGlobalKey",_u.store="targetGlobal";class Au{constructor(t,e){this.collectionId=t,this.parent=e}}Au.store="collectionParents",Au.keyPath=["collectionId","parent"];class Nu{constructor(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}}Nu.store="clientMetadata",Nu.keyPath="clientId";class xu{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}xu.store="bundles",xu.keyPath="bundleId";class Du{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}Du.store="namedQueries",Du.keyPath="name";const Ru=[...[...[...[...[mu.store,yu.store,vu.store,Iu.store,Tu.store,gu.store,_u.store,Su.store],Nu.store],Eu.store],Au.store],xu.store,Du.store],Cu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ku{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}class Ou{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Lu{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&eo(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Lu(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Lu?e:Lu.resolve(e)}catch(t){return Lu.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Lu.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Lu.reject(e)}static resolve(t){return new Lu(((e,n)=>{e(t)}))}static reject(t){return new Lu(((e,n)=>{n(t)}))}static waitFor(t){return new Lu(((e,n)=>{let r=0,i=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++i,s&&i===r&&e()}),(t=>n(t)))})),s=!0,i===r&&e()}))}static or(t){let e=Lu.resolve(!1);for(const n of t)e=e.next((t=>t?Lu.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}}class Pu{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Ou,this.transaction.oncomplete=()=>{this.ft.resolve()},this.transaction.onabort=()=>{e.error?this.ft.reject(new Vu(t,e.error)):this.ft.resolve()},this.transaction.onerror=e=>{const n=$u(e.target.error);this.ft.reject(new Vu(t,n))}}static open(t,e,n,r){try{return new Pu(e,t.transaction(r,n))}catch(t){throw new Vu(e,t)}}get dt(){return this.ft.promise}abort(t){t&&this.ft.reject(t),this.aborted||(Ys("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new Bu(e)}}class Mu{constructor(t,e,n){this.name=t,this.version=e,this.wt=n;12.2===Mu._t(c())&&Js("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return Ys("SimpleDb","Removing database:",t),qu(window.indexedDB.deleteDatabase(t)).toPromise()}static gt(){if("undefined"==typeof indexedDB)return!1;if(Mu.yt())return!0;const t=c(),e=Mu._t(t),n=0<e&&e<10,r=Mu.Et(t),i=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static yt(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)}static It(t,e){return t.store(e)}static _t(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Et(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async At(t){return this.db||(Ys("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new Vu(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new Gs(Hs.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new Vu(t,r))},r.onupgradeneeded=t=>{Ys("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.wt.Rt(e,r.transaction,t.oldVersion,this.version).next((()=>{Ys("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.Pt&&(this.db.onversionchange=t=>this.Pt(t)),this.db}bt(t){this.Pt=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const i="readonly"===e;let s=0;for(;;){++s;try{this.db=await this.At(t);const e=Pu.open(this.db,t,i?"readonly":"readwrite",n),s=r(e).catch((t=>(e.abort(t),Lu.reject(t)))).toPromise();return s.catch((()=>{})),await e.dt,s}catch(t){const e="FirebaseError"!==t.name&&s<3;if(Ys("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Fu{constructor(t){this.vt=t,this.Vt=!1,this.St=null}get isDone(){return this.Vt}get Dt(){return this.St}set cursor(t){this.vt=t}done(){this.Vt=!0}Ct(t){this.St=t}delete(){return qu(this.vt.delete())}}class Vu extends Gs{constructor(t,e){super(Hs.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Uu(t){return"IndexedDbTransactionError"===t.name}class Bu{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(Ys("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Ys("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),qu(n)}add(t){Ys("SimpleDb","ADD",this.store.name,t,t);return qu(this.store.add(t))}get(t){return qu(this.store.get(t)).next((e=>(void 0===e&&(e=null),Ys("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){Ys("SimpleDb","DELETE",this.store.name,t);return qu(this.store.delete(t))}count(){Ys("SimpleDb","COUNT",this.store.name);return qu(this.store.count())}Nt(t,e){const n=this.cursor(this.options(t,e)),r=[];return this.xt(n,((t,e)=>{r.push(e)})).next((()=>r))}kt(t,e){Ys("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.$t=!1;const r=this.cursor(n);return this.xt(r,((t,e,n)=>n.delete()))}Ot(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.xt(r,e)}Ft(t){const e=this.cursor({});return new Lu(((n,r)=>{e.onerror=t=>{const e=$u(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}xt(t,e){const n=[];return new Lu(((r,i)=>{t.onerror=t=>{i(t.target.error)},t.onsuccess=t=>{const i=t.target.result;if(!i)return void r();const s=new Fu(i),o=e(i.primaryKey,i.value,s);if(o instanceof Lu){const t=o.catch((t=>(s.done(),Lu.reject(t))));n.push(t)}s.isDone?r():null===s.Dt?i.continue():i.continue(s.Dt)}})).next((()=>Lu.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.$t?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function qu(t){return new Lu(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=$u(t.target.error);n(e)}}))}let ju=!1;function $u(t){const e=Mu._t(c());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Gs("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ju||(ju=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Ku extends ku{constructor(t,e){super(),this.Mt=t,this.currentSequenceNumber=e}}function zu(t,e){const n=ro(t);return Mu.It(n.Mt,e)}class Hu{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];if(r.key.isEqual(t.key)){Za(r,t,n[e])}}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&tc(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&tc(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach((e=>{const n=t.get(e.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(ho.min())}))}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Nc())}isEqual(t){return this.batchId===t.batchId&&ao(this.mutations,t.mutations,((t,e)=>nc(t,e)))&&ao(this.baseMutations,t.baseMutations,((t,e)=>nc(t,e)))}}class Gu{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){no(t.mutations.length===n.length);let r=_c();const i=t.mutations;for(let t=0;t<i.length;t++)r=r.insert(i[t].key,n[t].version);return new Gu(t,e,n,r)}}class Qu{constructor(t,e,n,r,i=ho.min(),s=ho.min(),o=bo.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(t){return new Qu(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new Qu(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new Qu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class Xu{constructor(t){this.Lt=t}}function Wu(t,e){if(e.document)return Hc(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=Ro.fromSegments(e.noDocument.path),n=eh(e.noDocument.readTime),r=Ho.newNoDocument(t,n);return e.hasCommittedMutations?r.setHasCommittedMutations():r}if(e.unknownDocument){const t=Ro.fromSegments(e.unknownDocument.path),n=eh(e.unknownDocument.version);return Ho.newUnknownDocument(t,n)}return eo()}function Yu(t,e,n){const r=Ju(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){const n=function(t,e){return{name:Uc(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Oc(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Iu(null,null,n,s,r,i)}if(e.isNoDocument()){const t=e.key.path.toArray(),n=th(e.version),s=e.hasCommittedMutations;return new Iu(null,new wu(t,n),null,s,r,i)}if(e.isUnknownDocument()){const t=e.key.path.toArray(),n=th(e.version);return new Iu(new bu(t,n),null,null,!0,r,i)}return eo()}function Ju(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Zu(t){const e=new uo(t[0],t[1]);return ho.fromTimestamp(e)}function th(t){const e=t.toTimestamp();return new pu(e.seconds,e.nanoseconds)}function eh(t){const e=new uo(t.seconds,t.nanoseconds);return ho.fromTimestamp(e)}function nh(t,e){const n=(e.baseMutations||[]).map((e=>Qc(t.Lt,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const r=e.mutations[t+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const r=e.mutations.map((e=>Qc(t.Lt,e))),i=uo.fromMillis(e.localWriteTimeMs);return new Hu(e.batchId,i,n,r)}function rh(t){const e=eh(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?eh(t.lastLimboFreeSnapshotVersion):ho.min();let r;var i;return void 0!==t.query.documents?(no(1===(i=t.query).documents.length),r=Sa(ya(jc(i.documents[0])))):r=function(t){return Sa(Jc(t))}(t.query),new Qu(r,t.targetId,0,t.lastListenSequenceNumber,e,n,bo.fromBase64String(t.resumeToken))}function ih(t,e){const n=th(e.snapshotVersion),r=th(e.lastLimboFreeSnapshotVersion);let i;i=Jo(e.target)?Wc(t.Lt,e.target):Yc(t.Lt,e.target);const s=e.resumeToken.toBase64();return new Tu(e.targetId,Xo(e.target),n,s,e.sequenceNumber,r,i)}function sh(t){const e=Jc({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?_a(e,e.limit,"L"):e}class oh{getBundleMetadata(t,e){return ah(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:eh(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return ah(t).put({bundleId:(n=e).id,createTime:th(Mc(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return ch(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:sh(e.bundledQuery),readTime:eh(e.readTime)};var e}))}saveNamedQuery(t,e){return ch(t).put(function(t){return{name:t.name,readTime:th(Mc(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function ah(t){return zu(t,xu.store)}function ch(t){return zu(t,Du.store)}class uh{constructor(){this.Bt=new hh}addToCollectionParentIndex(t,e){return this.Bt.add(e),Lu.resolve()}getCollectionParents(t,e){return Lu.resolve(this.Bt.getEntries(e))}}class hh{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new vc(mo.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new vc(mo.comparator)).toArray()}}class lh{constructor(){this.Ut=new hh}addToCollectionParentIndex(t,e){if(!this.Ut.has(e)){const n=e.lastSegment(),r=e.popLast();t.addOnCommittedListener((()=>{this.Ut.add(e)}));const i={collectionId:n,parent:hu(r)};return fh(t).put(i)}return Lu.resolve()}getCollectionParents(t,e){const n=[],r=IDBKeyRange.bound([e,""],[co(e),""],!1,!0);return fh(t).Nt(r).next((t=>{for(const r of t){if(r.collectionId!==e)break;n.push(du(r.parent))}return n}))}}function fh(t){return zu(t,Au.store)}const dh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ph{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new ph(t,ph.DEFAULT_COLLECTION_PERCENTILE,ph.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function gh(t,e,n){const r=t.store(yu.store),i=t.store(vu.store),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Ot({range:o},((t,e,n)=>(a++,n.delete())));s.push(c.next((()=>{no(1===a)})));const u=[];for(const t of n.mutations){const r=vu.key(e,t.key.path,n.batchId);s.push(i.delete(r)),u.push(t.key)}return Lu.waitFor(s).next((()=>u))}function mh(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw eo();e=t.noDocument}return JSON.stringify(e).length}ph.DEFAULT_COLLECTION_PERCENTILE=10,ph.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ph.DEFAULT=new ph(41943040,ph.DEFAULT_COLLECTION_PERCENTILE,ph.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ph.DISABLED=new ph(-1,0,0);class yh{constructor(t,e,n,r){this.userId=t,this.R=e,this.qt=n,this.referenceDelegate=r,this.Kt={}}static Qt(t,e,n,r){no(""!==t.uid);const i=t.isAuthenticated()?t.uid:"";return new yh(i,e,n,r)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return wh(t).Ot({index:yu.userMutationsIndex,range:n},((t,n,r)=>{e=!1,r.done()})).next((()=>e))}addMutationBatch(t,e,n,r){const i=bh(t),s=wh(t);return s.add({}).next((o=>{no("number"==typeof o);const a=new Hu(o,e,n,r),c=function(t,e,n){const r=n.baseMutations.map((e=>Gc(t.Lt,e))),i=n.mutations.map((e=>Gc(t.Lt,e)));return new yu(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(this.R,this.userId,a),u=[];let h=new vc(((t,e)=>oo(t.canonicalString(),e.canonicalString())));for(const t of r){const e=vu.key(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),u.push(s.put(c)),u.push(i.put(e,vu.PLACEHOLDER))}return h.forEach((e=>{u.push(this.qt.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.Kt[o]=a.keys()})),Lu.waitFor(u).next((()=>a))}))}lookupMutationBatch(t,e){return wh(t).get(e).next((t=>t?(no(t.userId===this.userId),nh(this.R,t)):null))}jt(t,e){return this.Kt[e]?Lu.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.Kt[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return wh(t).Ot({index:yu.userMutationsIndex,range:r},((t,e,r)=>{e.userId===this.userId&&(no(e.batchId>=n),i=nh(this.R,e)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return wh(t).Ot({index:yu.userMutationsIndex,range:e,reverse:!0},((t,e,r)=>{n=e.batchId,r.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return wh(t).Nt(yu.userMutationsIndex,e).next((t=>t.map((t=>nh(this.R,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=vu.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(n),i=[];return bh(t).Ot({range:r},((n,r,s)=>{const[o,a,c]=n,u=du(a);if(o===this.userId&&e.path.isEqual(u))return wh(t).get(c).next((t=>{if(!t)throw eo();no(t.userId===this.userId),i.push(nh(this.R,t))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new vc(oo);const r=[];return e.forEach((e=>{const i=vu.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(i),o=bh(t).Ot({range:s},((t,r,i)=>{const[s,o,a]=t,c=du(o);s===this.userId&&e.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),Lu.waitFor(r).next((()=>this.Wt(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1,i=vu.prefixForPath(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new vc(oo);return bh(t).Ot({range:s},((t,e,i)=>{const[s,a,c]=t,u=du(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.Wt(t,o)))}Wt(t,e){const n=[],r=[];return e.forEach((e=>{r.push(wh(t).get(e).next((t=>{if(null===t)throw eo();no(t.userId===this.userId),n.push(nh(this.R,t))})))})),Lu.waitFor(r).next((()=>n))}removeMutationBatch(t,e){return gh(t.Mt,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.Gt(e.batchId)})),Lu.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}Gt(t){delete this.Kt[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return Lu.resolve();const n=IDBKeyRange.lowerBound(vu.prefixForUser(this.userId)),r=[];return bh(t).Ot({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=du(t[1]);r.push(e)}else n.done()})).next((()=>{no(0===r.length)}))}))}containsKey(t,e){return vh(t,this.userId,e)}zt(t){return Ih(t).get(this.userId).next((t=>t||new mu(this.userId,-1,"")))}}function vh(t,e,n){const r=vu.prefixForPath(e,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return bh(t).Ot({range:s,$t:!0},((t,n,r)=>{const[s,a,c]=t;s===e&&a===i&&(o=!0),r.done()})).next((()=>o))}function wh(t){return zu(t,yu.store)}function bh(t){return zu(t,vu.store)}function Ih(t){return zu(t,mu.store)}class Eh{constructor(t){this.Ht=t}next(){return this.Ht+=2,this.Ht}static Jt(){return new Eh(0)}static Yt(){return new Eh(-1)}}class Th{constructor(t,e){this.referenceDelegate=t,this.R=e}allocateTargetId(t){return this.Xt(t).next((e=>{const n=new Eh(e.highestTargetId);return e.highestTargetId=n.next(),this.Zt(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.Xt(t).next((t=>ho.fromTimestamp(new uo(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.Xt(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.Xt(t).next((r=>(r.highestListenSequenceNumber=e,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),e>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=e),this.Zt(t,r))))}addTargetData(t,e){return this.te(t,e).next((()=>this.Xt(t).next((n=>(n.targetCount+=1,this.ee(e,n),this.Zt(t,n))))))}updateTargetData(t,e){return this.te(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>Sh(t).delete(e.targetId))).next((()=>this.Xt(t))).next((e=>(no(e.targetCount>0),e.targetCount-=1,this.Zt(t,e))))}removeTargets(t,e,n){let r=0;const i=[];return Sh(t).Ot(((s,o)=>{const a=rh(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(t,a)))})).next((()=>Lu.waitFor(i))).next((()=>r))}forEachTarget(t,e){return Sh(t).Ot(((t,n)=>{const r=rh(n);e(r)}))}Xt(t){return _h(t).get(_u.key).next((t=>(no(null!==t),t)))}Zt(t,e){return _h(t).put(_u.key,e)}te(t,e){return Sh(t).put(ih(this.R,e))}ee(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Xt(t).next((t=>t.targetCount))}getTargetData(t,e){const n=Xo(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Sh(t).Ot({range:r,index:Tu.queryTargetsIndexName},((t,n,r)=>{const s=rh(n);Yo(e,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(t,e,n){const r=[],i=Ah(t);return e.forEach((e=>{const s=hu(e.path);r.push(i.put(new Su(n,s))),r.push(this.referenceDelegate.addReference(t,n,e))})),Lu.waitFor(r)}removeMatchingKeys(t,e,n){const r=Ah(t);return Lu.forEach(e,(e=>{const i=hu(e.path);return Lu.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=Ah(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Ah(t);let i=Nc();return r.Ot({range:n,$t:!0},((t,e,n)=>{const r=du(t[1]),s=new Ro(r);i=i.add(s)})).next((()=>i))}containsKey(t,e){const n=hu(e.path),r=IDBKeyRange.bound([n],[co(n)],!1,!0);let i=0;return Ah(t).Ot({index:Su.documentTargetsIndex,$t:!0,range:r},(([t,e],n,r)=>{0!==t&&(i++,r.done())})).next((()=>i>0))}lt(t,e){return Sh(t).get(e).next((t=>t?rh(t):null))}}function Sh(t){return zu(t,Tu.store)}function _h(t){return zu(t,_u.store)}function Ah(t){return zu(t,Su.store)}async function Nh(t){if(t.code!==Hs.FAILED_PRECONDITION||t.message!==Cu)throw t;Ys("LocalStore","Unexpectedly lost primary lease")}function xh([t,e],[n,r]){const i=oo(t,n);return 0===i?oo(e,r):i}class Dh{constructor(t){this.ne=t,this.buffer=new vc(xh),this.se=0}ie(){return++this.se}re(t){const e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();xh(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Rh{constructor(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}start(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ae(t)}stop(){this.ce&&(this.ce.cancel(),this.ce=null)}get started(){return null!==this.ce}ae(t){const e=this.oe?3e5:6e4;Ys("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.ce=null,this.oe=!0;try{await t.collectGarbage(this.garbageCollector)}catch(t){Uu(t)?Ys("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Nh(t)}await this.ae(t)}))}}class Ch{constructor(t,e){this.ue=t,this.params=e}calculateTargetCount(t,e){return this.ue.he(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return Lu.resolve(zs.o);const n=new Dh(e);return this.ue.forEachTarget(t,(t=>n.re(t.sequenceNumber))).next((()=>this.ue.le(t,(t=>n.re(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.ue.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.ue.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(Ys("LruGarbageCollector","Garbage collection skipped; disabled"),Lu.resolve(dh)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(Ys("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),dh):this.fe(t,e)))}getCacheSize(t){return this.ue.getCacheSize(t)}fe(t,e){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(Ys("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),this.nthSequenceNumber(t,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(i=e,a=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>{if(c=Date.now(),Xs()<=D.DEBUG){Ys("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`)}return Lu.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))}}class kh{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new Ch(t,e)}(this,e)}he(t){const e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}de(t){let e=0;return this.le(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}le(t,e){return this.we(t,((t,n)=>e(n)))}addReference(t,e,n){return Oh(t,n)}removeReference(t,e,n){return Oh(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Oh(t,e)}_e(t,e){return function(t,e){let n=!1;return Ih(t).Ft((r=>vh(t,r,e).next((t=>(t&&(n=!0),Lu.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.we(t,((s,o)=>{if(o<=e){const e=this._e(t,s).next((e=>{if(!e)return i++,n.getEntry(t,s).next((()=>(n.removeEntry(s),Ah(t).delete([0,hu(s.path)]))))}));r.push(e)}})).next((()=>Lu.waitFor(r))).next((()=>n.apply(t))).next((()=>i))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Oh(t,e)}we(t,e){const n=Ah(t);let r,i=zs.o;return n.Ot({index:Su.documentTargetsIndex},(([t,n],{path:s,sequenceNumber:o})=>{0===t?(i!==zs.o&&e(new Ro(du(r)),i),i=o,r=s):i=zs.o})).next((()=>{i!==zs.o&&e(new Ro(du(r)),i)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function Oh(t,e){return Ah(t).put(function(t,e){return new Su(0,hu(t.path),e)}(e,t.currentSequenceNumber))}class Lh{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1}forEach(t){fo(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return po(this.inner)}}class Ph{constructor(){this.changes=new Lh((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}getReadTime(t){const e=this.changes.get(t);return e?e.readTime:ho.min()}addEntry(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})}removeEntry(t,e=null){this.assertNotApplied(),this.changes.set(t,{document:Ho.newInvalidDocument(t),readTime:e})}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Lu.resolve(n.document):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Mh{constructor(t,e){this.R=t,this.qt=e}addEntry(t,e,n){return Uh(t).put(Bh(e),n)}removeEntry(t,e){const n=Uh(t),r=Bh(e);return n.delete(r)}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.me(t,n))))}getEntry(t,e){return Uh(t).get(Bh(e)).next((t=>this.ge(e,t)))}ye(t,e){return Uh(t).get(Bh(e)).next((t=>({document:this.ge(e,t),size:mh(t)})))}getEntries(t,e){let n=Ic();return this.pe(t,e,((t,e)=>{const r=this.ge(t,e);n=n.insert(t,r)})).next((()=>n))}Ee(t,e){let n=Ic(),r=new gc(Ro.comparator);return this.pe(t,e,((t,e)=>{const i=this.ge(t,e);n=n.insert(t,i),r=r.insert(t,mh(e))})).next((()=>({documents:n,Te:r})))}pe(t,e,n){if(e.isEmpty())return Lu.resolve();const r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator();let s=i.getNext();return Uh(t).Ot({range:r},((t,e,r)=>{const o=Ro.fromSegments(t);for(;s&&Ro.comparator(s,o)<0;)n(s,null),s=i.getNext();s&&s.isEqual(o)&&(n(s,e),s=i.hasNext()?i.getNext():null),s?r.Ct(s.path.toArray()):r.done()})).next((()=>{for(;s;)n(s,null),s=i.hasNext()?i.getNext():null}))}getDocumentsMatchingQuery(t,e,n){let r=Ic();const i=e.path.length+1,s={};if(n.isEqual(ho.min())){const t=e.path.toArray();s.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.toArray(),r=Ju(n);s.range=IDBKeyRange.lowerBound([t,r],!0),s.index=Iu.collectionReadTimeIndex}return Uh(t).Ot(s,((t,n,s)=>{if(t.length!==i)return;const o=Wu(this.R,n);e.path.isPrefixOf(o.key.path)?Da(e,o)&&(r=r.insert(o.key,o)):s.done()})).next((()=>r))}newChangeBuffer(t){return new Fh(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return Vh(t).get(Eu.key).next((t=>(no(!!t),t)))}me(t,e){return Vh(t).put(Eu.key,e)}ge(t,e){if(e){const t=Wu(this.R,e);if(!(t.isNoDocument()&&t.version.isEqual(ho.min())))return t}return Ho.newInvalidDocument(t)}}class Fh extends Ph{constructor(t,e){super(),this.Ie=t,this.trackRemovals=e,this.Ae=new Lh((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,r=new vc(((t,e)=>oo(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.Ae.get(i);if(s.document.isValidDocument()){const a=Yu(this.Ie.R,s.document,this.getReadTime(i));r=r.add(i.path.popLast());const c=mh(a);n+=c-o,e.push(this.Ie.addEntry(t,i,a))}else if(n-=o,this.trackRemovals){const n=Yu(this.Ie.R,Ho.newNoDocument(i,ho.min()),this.getReadTime(i));e.push(this.Ie.addEntry(t,i,n))}else e.push(this.Ie.removeEntry(t,i))})),r.forEach((n=>{e.push(this.Ie.qt.addToCollectionParentIndex(t,n))})),e.push(this.Ie.updateMetadata(t,n)),Lu.waitFor(e)}getFromCache(t,e){return this.Ie.ye(t,e).next((t=>(this.Ae.set(e,t.size),t.document)))}getAllFromCache(t,e){return this.Ie.Ee(t,e).next((({documents:t,Te:e})=>(e.forEach(((t,e)=>{this.Ae.set(t,e)})),t)))}}function Vh(t){return zu(t,Eu.store)}function Uh(t){return zu(t,Iu.store)}function Bh(t){return t.path.toArray()}class qh{constructor(t){this.R=t}Rt(t,e,n,r){no(n<r&&n>=0&&r<=11);const i=new Pu("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(gu.store)}(t),function(t){t.createObjectStore(mu.store,{keyPath:mu.keyPath});t.createObjectStore(yu.store,{keyPath:yu.keyPath,autoIncrement:!0}).createIndex(yu.userMutationsIndex,yu.userMutationsKeyPath,{unique:!0}),t.createObjectStore(vu.store)}(t),jh(t),function(t){t.createObjectStore(Iu.store)}(t));let s=Lu.resolve();return n<3&&r>=3&&(0!==n&&(!function(t){t.deleteObjectStore(Su.store),t.deleteObjectStore(Tu.store),t.deleteObjectStore(_u.store)}(t),jh(t)),s=s.next((()=>function(t){const e=t.store(_u.store),n=new _u(0,0,ho.min().toTimestamp(),0);return e.put(_u.key,n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(t,e){return e.store(yu.store).Nt().next((n=>{t.deleteObjectStore(yu.store);t.createObjectStore(yu.store,{keyPath:yu.keyPath,autoIncrement:!0}).createIndex(yu.userMutationsIndex,yu.userMutationsKeyPath,{unique:!0});const r=e.store(yu.store),i=n.map((t=>r.put(t)));return Lu.waitFor(i)}))}(t,i)))),s=s.next((()=>{!function(t){t.createObjectStore(Nu.store,{keyPath:Nu.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((()=>this.Re(i)))),n<6&&r>=6&&(s=s.next((()=>(function(t){t.createObjectStore(Eu.store)}(t),this.Pe(i))))),n<7&&r>=7&&(s=s.next((()=>this.be(i)))),n<8&&r>=8&&(s=s.next((()=>this.ve(t,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(Iu.store);e.createIndex(Iu.readTimeIndex,Iu.readTimeIndexPath,{unique:!1}),e.createIndex(Iu.collectionReadTimeIndex,Iu.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.Ve(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(t){t.createObjectStore(xu.store,{keyPath:xu.keyPath})}(t),function(t){t.createObjectStore(Du.store,{keyPath:Du.keyPath})}(t)}))),s}Pe(t){let e=0;return t.store(Iu.store).Ot(((t,n)=>{e+=mh(n)})).next((()=>{const n=new Eu(e);return t.store(Eu.store).put(Eu.key,n)}))}Re(t){const e=t.store(mu.store),n=t.store(yu.store);return e.Nt().next((e=>Lu.forEach(e,(e=>{const r=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.Nt(yu.userMutationsIndex,r).next((n=>Lu.forEach(n,(n=>{no(n.userId===e.userId);const r=nh(this.R,n);return gh(t,e.userId,r).next((()=>{}))}))))}))))}be(t){const e=t.store(Su.store),n=t.store(Iu.store);return t.store(_u.store).get(_u.key).next((t=>{const r=[];return n.Ot(((n,i)=>{const s=new mo(n),o=function(t){return[0,hu(t)]}(s);r.push(e.get(o).next((n=>n?Lu.resolve():(n=>e.put(new Su(0,hu(n),t.highestListenSequenceNumber)))(s))))})).next((()=>Lu.waitFor(r)))}))}ve(t,e){t.createObjectStore(Au.store,{keyPath:Au.keyPath});const n=e.store(Au.store),r=new hh,i=t=>{if(r.add(t)){const e=t.lastSegment(),r=t.popLast();return n.put({collectionId:e,parent:hu(r)})}};return e.store(Iu.store).Ot({$t:!0},((t,e)=>{const n=new mo(t);return i(n.popLast())})).next((()=>e.store(vu.store).Ot({$t:!0},(([t,e,n],r)=>{const s=du(e);return i(s.popLast())}))))}Ve(t){const e=t.store(Tu.store);return e.Ot(((t,n)=>{const r=rh(n),i=ih(this.R,r);return e.put(i)}))}}function jh(t){t.createObjectStore(Su.store,{keyPath:Su.keyPath}).createIndex(Su.documentTargetsIndex,Su.documentTargetsKeyPath,{unique:!0});t.createObjectStore(Tu.store,{keyPath:Tu.keyPath}).createIndex(Tu.queryTargetsIndexName,Tu.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(_u.store)}const $h="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Kh{constructor(t,e,n,r,i,s,o,a,c,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Se=i,this.window=s,this.document=o,this.De=c,this.Ce=u,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.$e=null,this.Oe=null,this.Fe=Number.NEGATIVE_INFINITY,this.Me=t=>Promise.resolve(),!Kh.gt())throw new Gs(Hs.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new kh(this,r),this.Le=e+"main",this.R=new Xu(a),this.Be=new Mu(this.Le,11,new qh(this.R)),this.Ue=new Th(this.referenceDelegate,this.R),this.qt=new lh,this.qe=function(t,e){return new Mh(t,e)}(this.R,this.qt),this.Ke=new oh,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===u&&Js("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.je().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Gs(Hs.FAILED_PRECONDITION,$h);return this.We(),this.Ge(),this.ze(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.Ue.getHighestSequenceNumber(t)))})).then((t=>{this.Ne=new zs(t,this.De)})).then((()=>{this.xe=!0})).catch((t=>(this.Be&&this.Be.close(),Promise.reject(t))))}He(t){return this.Me=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Be.bt((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((async()=>{this.started&&await this.je()})))}je(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>Hh(t).put(new Nu(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next((()=>{if(this.isPrimary)return this.Je(t).next((t=>{t||(this.isPrimary=!1,this.Se.enqueueRetryable((()=>this.Me(!1))))}))})).next((()=>this.Ye(t))).next((e=>this.isPrimary&&!e?this.Xe(t).next((()=>!1)):!!e&&this.Ze(t).next((()=>!0)))))).catch((t=>{if(Uu(t))return Ys("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return Ys("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Se.enqueueRetryable((()=>this.Me(t))),this.isPrimary=t}))}Je(t){return zh(t).get(gu.key).next((t=>Lu.resolve(this.tn(t))))}en(t){return Hh(t).delete(this.clientId)}async nn(){if(this.isPrimary&&!this.sn(this.Fe,18e5)){this.Fe=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=zu(t,Nu.store);return e.Nt().next((t=>{const n=this.rn(t,18e5),r=t.filter((t=>-1===n.indexOf(t)));return Lu.forEach(r,(t=>e.delete(t.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.Qe)for(const e of t)this.Qe.removeItem(this.on(e.clientId))}}ze(){this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.je().then((()=>this.nn())).then((()=>this.ze()))))}tn(t){return!!t&&t.ownerId===this.clientId}Ye(t){if(this.Ce)return Lu.resolve(!0);return zh(t).get(gu.key).next((e=>{if(null!==e&&this.sn(e.leaseTimestampMs,5e3)&&!this.cn(e.ownerId)){if(this.tn(e)&&this.networkEnabled)return!0;if(!this.tn(e)){if(!e.allowTabSynchronization)throw new Gs(Hs.FAILED_PRECONDITION,$h);return!1}}return!(!this.networkEnabled||!this.inForeground)||Hh(t).Nt().next((t=>void 0===this.rn(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,r=this.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&Ys("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.xe=!1,this.an(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.un(),this.hn(),await this.Be.runTransaction("shutdown","readwrite",[gu.store,Nu.store],(t=>{const e=new Ku(t,zs.o);return this.Xe(e).next((()=>this.en(e)))})),this.Be.close(),this.ln()}rn(t,e){return t.filter((t=>this.sn(t.updateTimeMs,e)&&!this.cn(t.clientId)))}fn(){return this.runTransaction("getActiveClients","readonly",(t=>Hh(t).Nt().next((t=>this.rn(t,18e5).map((t=>t.clientId))))))}get started(){return this.xe}getMutationQueue(t){return yh.Qt(t,this.R,this.qt,this.referenceDelegate)}getTargetCache(){return this.Ue}getRemoteDocumentCache(){return this.qe}getIndexManager(){return this.qt}getBundleCache(){return this.Ke}runTransaction(t,e,n){Ys("IndexedDbPersistence","Starting transaction:",t);const r="readonly"===e?"readonly":"readwrite";let i;return this.Be.runTransaction(t,r,Ru,(r=>(i=new Ku(r,this.Ne?this.Ne.next():zs.o),"readwrite-primary"===e?this.Je(i).next((t=>!!t||this.Ye(i))).next((e=>{if(!e)throw Js(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Se.enqueueRetryable((()=>this.Me(!1))),new Gs(Hs.FAILED_PRECONDITION,Cu);return n(i)})).next((t=>this.Ze(i).next((()=>t)))):this.dn(i).next((()=>n(i)))))).then((t=>(i.raiseOnCommittedEvent(),t)))}dn(t){return zh(t).get(gu.key).next((t=>{if(null!==t&&this.sn(t.leaseTimestampMs,5e3)&&!this.cn(t.ownerId)&&!this.tn(t)&&!(this.Ce||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Gs(Hs.FAILED_PRECONDITION,$h)}))}Ze(t){const e=new gu(this.clientId,this.allowTabSynchronization,Date.now());return zh(t).put(gu.key,e)}static gt(){return Mu.gt()}Xe(t){const e=zh(t);return e.get(gu.key).next((t=>this.tn(t)?(Ys("IndexedDbPersistence","Releasing primary lease."),e.delete(gu.key)):Lu.resolve()))}sn(t,e){const n=Date.now();return!(t<n-e)&&(!(t>n)||(Js(`Detected an update time that is in the future: ${t} > ${n}`),!1))}We(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.$e=()=>{this.Se.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.je())))},this.document.addEventListener("visibilitychange",this.$e),this.inForeground="visible"===this.document.visibilityState)}un(){this.$e&&(this.document.removeEventListener("visibilitychange",this.$e),this.$e=null)}Ge(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=()=>{this.an(),this.Se.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ke))}hn(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)}cn(t){var e;try{const n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return Ys("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return Js("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}an(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Js("Failed to set zombie client id.",t)}}ln(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}}on(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function zh(t){return zu(t,gu.store)}function Hh(t){return zu(t,Nu.store)}function Gh(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class Qh{constructor(t,e,n){this.qe=t,this._n=e,this.qt=n}mn(t,e){return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((n=>this.gn(t,e,n)))}gn(t,e,n){return this.qe.getEntry(t,e).next((t=>{for(const e of n)e.applyToLocalView(t);return t}))}yn(t,e){t.forEach(((t,n)=>{for(const t of e)t.applyToLocalView(n)}))}pn(t,e){return this.qe.getEntries(t,e).next((e=>this.En(t,e).next((()=>e))))}En(t,e){return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>this.yn(e,t)))}getDocumentsMatchingQuery(t,e,n){return function(t){return Ro.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Ea(e)?this.In(t,e,n):this.An(t,e,n)}Tn(t,e){return this.mn(t,new Ro(e)).next((t=>{let e=Tc();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}In(t,e,n){const r=e.collectionGroup;let i=Tc();return this.qt.getCollectionParents(t,r).next((s=>Lu.forEach(s,(s=>{const o=function(t,e){return new ga(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(r));return this.An(t,o,n).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}An(t,e,n){let r,i;return this.qe.getDocumentsMatchingQuery(t,e,n).next((n=>(r=n,this._n.getAllMutationBatchesAffectingQuery(t,e)))).next((e=>(i=e,this.Rn(t,i,r).next((t=>{r=t;for(const t of i)for(const e of t.mutations){const n=e.key;let i=r.get(n);null==i&&(i=Ho.newInvalidDocument(n),r=r.insert(n,i)),tc(e,i,t.localWriteTime),i.isFoundDocument()||(r=r.remove(n))}}))))).next((()=>(r.forEach(((t,n)=>{Da(e,n)||(r=r.remove(t))})),r)))}Rn(t,e,n){let r=Nc();for(const t of e)for(const e of t.mutations)e instanceof sc&&null===n.get(e.key)&&(r=r.add(e.key));let i=n;return this.qe.getEntries(t,r).next((t=>(t.forEach(((t,e)=>{e.isFoundDocument()&&(i=i.insert(t,e))})),i)))}}class Xh{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Pn=n,this.bn=r}static vn(t,e){let n=Nc(),r=Nc();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Xh(t,e.fromCache,n,r)}}class Wh{Vn(t){this.Sn=t}getDocumentsMatchingQuery(t,e,n,r){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(ho.min())?this.Dn(t,e):this.Sn.pn(t,r).next((i=>{const s=this.Cn(e,i);return(va(e)||wa(e))&&this.Nn(e.limitType,s,r,n)?this.Dn(t,e):(Xs()<=D.DEBUG&&Ys("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),xa(e)),this.Sn.getDocumentsMatchingQuery(t,e,n).next((t=>(s.forEach((e=>{t=t.insert(e.key,e)})),t))))}))}Cn(t,e){let n=new vc(Ra(t));return e.forEach(((e,r)=>{Da(t,r)&&(n=n.add(r))})),n}Nn(t,e,n,r){if(n.size!==e.size)return!0;const i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Dn(t,e){return Xs()<=D.DEBUG&&Ys("QueryEngine","Using full collection scan to execute query:",xa(e)),this.Sn.getDocumentsMatchingQuery(t,e,ho.min())}}class Yh{constructor(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new gc(oo),this.$n=new Lh((t=>Xo(t)),Yo),this.On=ho.min(),this._n=t.getMutationQueue(n),this.Fn=t.getRemoteDocumentCache(),this.Ue=t.getTargetCache(),this.Mn=new Qh(this.Fn,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.kn)))}}function Jh(t,e,n,r){return new Yh(t,e,n,r)}async function Zh(t,e){const n=ro(t);let r=n._n,i=n.Mn;const s=await n.persistence.runTransaction("Handle user change","readonly",(t=>{let s;return n._n.getAllMutationBatches(t).next((o=>(s=o,r=n.persistence.getMutationQueue(e),i=new Qh(n.Fn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)))).next((e=>{const n=[],r=[];let o=Nc();for(const t of s){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return i.pn(t,o).next((t=>({Ln:t,removedBatchIds:n,addedBatchIds:r})))}))}));return n._n=r,n.Mn=i,n.xn.Vn(n.Mn),s}function tl(t,e){const n=ro(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),i=n.Fn.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const i=n.batch,s=i.keys();let o=Lu.resolve();return s.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const s=n.docVersions.get(t);no(null!==s),e.version.compareTo(s)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),o.next((()=>t._n.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n._n.performConsistencyCheck(t))).next((()=>n.Mn.pn(t,r)))}))}function el(t){const e=ro(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ue.getLastRemoteSnapshotVersion(t)))}function nl(t,e){const n=ro(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e))))}async function rl(t){const e=ro(t);return e.persistence.runTransaction("Synchronize last document change read time","readonly",(t=>function(t){const e=Uh(t);let n=ho.min();return e.Ot({index:Iu.readTimeIndex,reverse:!0},((t,e,r)=>{e.readTime&&(n=Zu(e.readTime)),r.done()})).next((()=>n))}(t))).then((t=>{e.On=t}))}class il{constructor(t){this.R=t,this.Qn=new Map,this.jn=new Map}getBundleMetadata(t,e){return Lu.resolve(this.Qn.get(e))}saveBundleMetadata(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:Mc(n.createTime)}),Lu.resolve()}getNamedQuery(t,e){return Lu.resolve(this.jn.get(e))}saveNamedQuery(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:sh(t.bundledQuery),readTime:Mc(t.readTime)}}(e)),Lu.resolve()}}class sl{constructor(){this.Wn=new vc(ol.Gn),this.zn=new vc(ol.Hn)}isEmpty(){return this.Wn.isEmpty()}addReference(t,e){const n=new ol(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)}Jn(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Yn(new ol(t,e))}Xn(t,e){t.forEach((t=>this.removeReference(t,e)))}Zn(t){const e=new Ro(new mo([])),n=new ol(e,t),r=new ol(e,t+1),i=[];return this.zn.forEachInRange([n,r],(t=>{this.Yn(t),i.push(t.key)})),i}ts(){this.Wn.forEach((t=>this.Yn(t)))}Yn(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)}es(t){const e=new Ro(new mo([])),n=new ol(e,t),r=new ol(e,t+1);let i=Nc();return this.zn.forEachInRange([n,r],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new ol(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class ol{constructor(t,e){this.key=t,this.ns=e}static Gn(t,e){return Ro.comparator(t.key,e.key)||oo(t.ns,e.ns)}static Hn(t,e){return oo(t.ns,e.ns)||Ro.comparator(t.key,e.key)}}class al{constructor(t,e){this.qt=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new vc(ol.Gn)}checkEmpty(t){return Lu.resolve(0===this._n.length)}addMutationBatch(t,e,n,r){const i=this.ss;if(this.ss++,this._n.length>0){this._n[this._n.length-1]}const s=new Hu(i,e,n,r);this._n.push(s);for(const e of r)this.rs=this.rs.add(new ol(e.key,i)),this.qt.addToCollectionParentIndex(t,e.key.path.popLast());return Lu.resolve(s)}lookupMutationBatch(t,e){return Lu.resolve(this.os(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.cs(n),i=r<0?0:r;return Lu.resolve(this._n.length>i?this._n[i]:null)}getHighestUnacknowledgedBatchId(){return Lu.resolve(0===this._n.length?-1:this.ss-1)}getAllMutationBatches(t){return Lu.resolve(this._n.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new ol(e,0),r=new ol(e,Number.POSITIVE_INFINITY),i=[];return this.rs.forEachInRange([n,r],(t=>{const e=this.os(t.ns);i.push(e)})),Lu.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new vc(oo);return e.forEach((t=>{const e=new ol(t,0),r=new ol(t,Number.POSITIVE_INFINITY);this.rs.forEachInRange([e,r],(t=>{n=n.add(t.ns)}))})),Lu.resolve(this.us(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;Ro.isDocumentKey(i)||(i=i.child(""));const s=new ol(new Ro(i),0);let o=new vc(oo);return this.rs.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.ns)),!0)}),s),Lu.resolve(this.us(o))}us(t){const e=[];return t.forEach((t=>{const n=this.os(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){no(0===this.hs(e.batchId,"removed")),this._n.shift();let n=this.rs;return Lu.forEach(e.mutations,(r=>{const i=new ol(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.rs=n}))}Gt(t){}containsKey(t,e){const n=new ol(e,0),r=this.rs.firstAfterOrEqual(n);return Lu.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this._n.length,Lu.resolve()}hs(t,e){return this.cs(t)}cs(t){if(0===this._n.length)return 0;return t-this._n[0].batchId}os(t){const e=this.cs(t);if(e<0||e>=this._n.length)return null;return this._n[e]}}class cl{constructor(t,e){this.qt=t,this.ls=e,this.docs=new gc(Ro.comparator),this.size=0}addEntry(t,e,n){const r=e.key,i=this.docs.get(r),s=i?i.size:0,o=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:o,readTime:n}),this.size+=o-s,this.qt.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Lu.resolve(n?n.document.clone():Ho.newInvalidDocument(e))}getEntries(t,e){let n=Ic();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.clone():Ho.newInvalidDocument(t))})),Lu.resolve(n)}getDocumentsMatchingQuery(t,e,n){let r=Ic();const i=new Ro(e.path.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:t,value:{document:i,readTime:o}}=s.getNext();if(!e.path.isPrefixOf(t.path))break;o.compareTo(n)<=0||Da(e,i)&&(r=r.insert(i.key,i.clone()))}return Lu.resolve(r)}fs(t,e){return Lu.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new ul(this)}getSize(t){return Lu.resolve(this.size)}}class ul extends Ph{constructor(t){super(),this.Ie=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.document.isValidDocument()?e.push(this.Ie.addEntry(t,r.document,this.getReadTime(n))):this.Ie.removeEntry(n)})),Lu.waitFor(e)}getFromCache(t,e){return this.Ie.getEntry(t,e)}getAllFromCache(t,e){return this.Ie.getEntries(t,e)}}class hl{constructor(t){this.persistence=t,this.ds=new Lh((t=>Xo(t)),Yo),this.lastRemoteSnapshotVersion=ho.min(),this.highestTargetId=0,this.ws=0,this._s=new sl,this.targetCount=0,this.gs=Eh.Jt()}forEachTarget(t,e){return this.ds.forEach(((t,n)=>e(n))),Lu.resolve()}getLastRemoteSnapshotVersion(t){return Lu.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Lu.resolve(this.ws)}allocateTargetId(t){return this.highestTargetId=this.gs.next(),Lu.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Lu.resolve()}te(t){this.ds.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.gs=new Eh(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)}addTargetData(t,e){return this.te(e),this.targetCount+=1,Lu.resolve()}updateTargetData(t,e){return this.te(e),Lu.resolve()}removeTargetData(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,Lu.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.ds.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.ds.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),Lu.waitFor(i).next((()=>r))}getTargetCount(t){return Lu.resolve(this.targetCount)}getTargetData(t,e){const n=this.ds.get(e)||null;return Lu.resolve(n)}addMatchingKeys(t,e,n){return this._s.Jn(e,n),Lu.resolve()}removeMatchingKeys(t,e,n){this._s.Xn(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((e=>{i.push(r.markPotentiallyOrphaned(t,e))})),Lu.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this._s.Zn(e),Lu.resolve()}getMatchingKeysForTargetId(t,e){const n=this._s.es(e);return Lu.resolve(n)}containsKey(t,e){return Lu.resolve(this._s.containsKey(e))}}class ll{constructor(t,e){this.ys={},this.Ne=new zs(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.Ue=new hl(this);this.qt=new uh,this.qe=function(t,e){return new cl(t,e)}(this.qt,(t=>this.referenceDelegate.ps(t))),this.R=new Xu(e),this.Ke=new il(this.R)}start(){return Promise.resolve()}shutdown(){return this.xe=!1,Promise.resolve()}get started(){return this.xe}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.qt}getMutationQueue(t){let e=this.ys[t.toKey()];return e||(e=new al(this.qt,this.referenceDelegate),this.ys[t.toKey()]=e),e}getTargetCache(){return this.Ue}getRemoteDocumentCache(){return this.qe}getBundleCache(){return this.Ke}runTransaction(t,e,n){Ys("MemoryPersistence","Starting transaction:",t);const r=new fl(this.Ne.next());return this.referenceDelegate.Es(),n(r).next((t=>this.referenceDelegate.Ts(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Is(t,e){return Lu.or(Object.values(this.ys).map((n=>()=>n.containsKey(t,e))))}}class fl extends ku{constructor(t){super(),this.currentSequenceNumber=t}}class dl{constructor(t){this.persistence=t,this.As=new sl,this.Rs=null}static Ps(t){return new dl(t)}get bs(){if(this.Rs)return this.Rs;throw eo()}addReference(t,e,n){return this.As.addReference(n,e),this.bs.delete(n.toString()),Lu.resolve()}removeReference(t,e,n){return this.As.removeReference(n,e),this.bs.add(n.toString()),Lu.resolve()}markPotentiallyOrphaned(t,e){return this.bs.add(e.toString()),Lu.resolve()}removeTarget(t,e){this.As.Zn(e.targetId).forEach((t=>this.bs.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.bs.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Es(){this.Rs=new Set}Ts(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Lu.forEach(this.bs,(n=>{const r=Ro.fromPath(n);return this.vs(t,r).next((t=>{t||e.removeEntry(r)}))})).next((()=>(this.Rs=null,e.apply(t))))}updateLimboDocument(t,e){return this.vs(t,e).next((t=>{t?this.bs.delete(e.toString()):this.bs.add(e.toString())}))}ps(t){return 0}vs(t,e){return Lu.or([()=>Lu.resolve(this.As.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Is(t,e)])}}class pl{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}pl.UNAUTHENTICATED=new pl(null),pl.GOOGLE_CREDENTIALS=new pl("google-credentials-uid"),pl.FIRST_PARTY=new pl("first-party-uid");class gl{constructor(){this.activeTargetIds=Dc()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}Cs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ss(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class ml{constructor(){this.li=new gl,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.li.Ds(t),this.fi[t]||"not-current"}updateQueryState(t,e,n){this.fi[t]=e}removeLocalQueryTarget(t){this.li.Cs(t)}isLocalQueryTarget(t){return this.li.activeTargetIds.has(t)}clearQueryState(t){delete this.fi[t]}getAllActiveQueryTargets(){return this.li.activeTargetIds}isActiveQueryTarget(t){return this.li.activeTargetIds.has(t)}start(){return this.li=new gl,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(){}}class yl{di(t){}shutdown(){}}class vl{constructor(){this.wi=()=>this._i(),this.mi=()=>this.gi(),this.yi=[],this.pi()}di(t){this.yi.push(t)}shutdown(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)}pi(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)}_i(){Ys("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.yi)t(0)}gi(){Ys("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.yi)t(1)}static gt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const wl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class bl{constructor(t){this.Ei=t.Ei,this.Ti=t.Ti}Ii(t){this.Ai=t}Ri(t){this.Pi=t}onMessage(t){this.bi=t}close(){this.Ti()}send(t){this.Ei(t)}vi(){this.Ai()}Vi(t){this.Pi(t)}Si(t){this.bi(t)}}class Il extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Ni(t,e,n,r){const i=this.xi(t,e);Ys("RestConnection","Sending: ",i,n);const s={};return this.ki(s,r),this.$i(t,i,s,n).then((t=>(Ys("RestConnection","Received: ",t),t)),(e=>{throw Zs("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e}))}Oi(t,e,n,r){return this.Ni(t,e,n,r)}ki(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/"+Ks,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(const n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])}xi(t,e){const n=wl[t];return`${this.Di}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}$i(t,e,n,r){return new Promise(((i,s)=>{const o=new $s;o.listenOnce(Vs.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case Fs.NO_ERROR:const e=o.getResponseJson();Ys("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Fs.TIMEOUT:Ys("Connection",'RPC "'+t+'" timed out'),s(new Gs(Hs.DEADLINE_EXCEEDED,"Request time out"));break;case Fs.HTTP_ERROR:const n=o.getStatus();if(Ys("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Hs).indexOf(e)>=0?e:Hs.UNKNOWN}(t.status);s(new Gs(e,t.message))}else s(new Gs(Hs.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new Gs(Hs.UNAVAILABLE,"Connection failed."));break;default:eo()}}finally{Ys("Connection",'RPC "'+t+'" completed.')}}));const a=JSON.stringify(r);o.send(e,"POST",a,n,15)}))}Fi(t,e){const n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Ps(),i=Ms(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(s.xmlHttpFactory=new qs({})),this.ki(s.initMessageHeaders,e),u()||l()||f()||d()||p()||h()||(s.httpHeadersOverwriteParam="$httpHeaders");const o=n.join("");Ys("Connection","Creating WebChannel: "+o,s);const a=r.createWebChannel(o,s);let c=!1,g=!1;const m=new bl({Ei:t=>{g?Ys("Connection","Not sending because WebChannel is closed:",t):(c||(Ys("Connection","Opening WebChannel transport."),a.open(),c=!0),Ys("Connection","WebChannel sending:",t),a.send(t))},Ti:()=>a.close()}),y=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return y(a,js.EventType.OPEN,(()=>{g||Ys("Connection","WebChannel transport opened.")})),y(a,js.EventType.CLOSE,(()=>{g||(g=!0,Ys("Connection","WebChannel transport closed"),m.Vi())})),y(a,js.EventType.ERROR,(t=>{g||(g=!0,Zs("Connection","WebChannel transport errored:",t),m.Vi(new Gs(Hs.UNAVAILABLE,"The operation could not be completed")))})),y(a,js.EventType.MESSAGE,(t=>{var e;if(!g){const n=t.data[0];no(!!n);const r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){Ys("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=lc[t];if(void 0!==e)return pc(e)}(t),n=i.message;void 0===e&&(e=Hs.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),g=!0,m.Vi(new Gs(e,n)),a.close()}else Ys("Connection","WebChannel received:",n),m.Si(n)}})),y(i,Us.STAT_EVENT,(t=>{t.stat===Bs.PROXY?Ys("Connection","Detected buffering proxy"):t.stat===Bs.NOPROXY&&Ys("Connection","Detected no buffering proxy")})),setTimeout((()=>{m.vi()}),0),m}}function El(){return"undefined"!=typeof window?window:null}function Tl(){return"undefined"!=typeof document?document:null}function Sl(t){return new kc(t,!0)}class _l{constructor(t,e,n=1e3,r=1.5,i=6e4){this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.Ui=0,this.qi=null,this.Ki=Date.now(),this.reset()}reset(){this.Ui=0}Qi(){this.Ui=this.Bi}ji(t){this.cancel();const e=Math.floor(this.Ui+this.Wi()),n=Math.max(0,Date.now()-this.Ki),r=Math.max(0,e-n);r>0&&Ys("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ui} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.qi=this.Se.enqueueAfterDelay(this.timerId,r,(()=>(this.Ki=Date.now(),t()))),this.Ui*=this.Li,this.Ui<this.Mi&&(this.Ui=this.Mi),this.Ui>this.Bi&&(this.Ui=this.Bi)}Gi(){null!==this.qi&&(this.qi.skipDelay(),this.qi=null)}cancel(){null!==this.qi&&(this.qi.cancel(),this.qi=null)}Wi(){return(Math.random()-.5)*this.Ui}}class Al{constructor(t,e,n,r,i,s){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=s,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new _l(t,e)}tr(){return 1===this.state||2===this.state||4===this.state}er(){return 2===this.state}start(){3!==this.state?this.auth():this.nr()}async stop(){this.tr()&&await this.close(0)}sr(){this.state=0,this.Zi.reset()}ir(){this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(()=>this.rr())))}cr(t){this.ar(),this.stream.send(t)}async rr(){if(this.er())return this.close(0)}ar(){this.Xi&&(this.Xi.cancel(),this.Xi=null)}async close(t,e){this.ar(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Hs.RESOURCE_EXHAUSTED?(Js(e.toString()),Js("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===Hs.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ur(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Ri(e)}ur(){}auth(){this.state=1;const t=this.hr(this.Yi),e=this.Yi;this.Ji.getToken().then((t=>{this.Yi===e&&this.lr(t)}),(e=>{t((()=>{const t=new Gs(Hs.UNKNOWN,"Fetching auth token failed: "+e.message);return this.dr(t)}))}))}lr(t){const e=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((()=>{e((()=>(this.state=2,this.listener.Ii())))})),this.stream.Ri((t=>{e((()=>this.dr(t)))})),this.stream.onMessage((t=>{e((()=>this.onMessage(t)))}))}nr(){this.state=4,this.Zi.ji((async()=>{this.state=0,this.start()}))}dr(t){return Ys("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(3,t)}hr(t){return e=>{this.Se.enqueueAndForget((()=>this.Yi===t?e():(Ys("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Nl extends Al{constructor(t,e,n,r,i){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,i),this.R=r,this.yr=!1}get pr(){return this.yr}start(){this.yr=!1,this.lastStreamToken=void 0,super.start()}ur(){this.yr&&this.Er([])}wr(t){return this.Hi.Fi("Write",t)}onMessage(t){if(no(!!t.streamToken),this.lastStreamToken=t.streamToken,this.yr){this.Zi.reset();const e=Xc(t.writeResults,t.commitTime),n=Mc(t.commitTime);return this.listener.Tr(n,e)}return no(!t.writeResults||0===t.writeResults.length),this.yr=!0,this.listener.Ir()}Ar(){const t={};t.database=$c(this.R),this.cr(t)}Er(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Gc(this.R,t)))};this.cr(e)}}class xl extends class{}{constructor(t,e,n){super(),this.credentials=t,this.Hi=e,this.R=n,this.Rr=!1}Pr(){if(this.Rr)throw new Gs(Hs.FAILED_PRECONDITION,"The client has already been terminated.")}Ni(t,e,n){return this.Pr(),this.credentials.getToken().then((r=>this.Hi.Ni(t,e,n,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Hs.UNAUTHENTICATED&&this.credentials.invalidateToken(),t):new Gs(Hs.UNKNOWN,t.toString())}))}Oi(t,e,n){return this.Pr(),this.credentials.getToken().then((r=>this.Hi.Oi(t,e,n,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Hs.UNAUTHENTICATED&&this.credentials.invalidateToken(),t):new Gs(Hs.UNKNOWN,t.toString())}))}terminate(){this.Rr=!0}}class Dl{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.br=0,this.vr=null,this.Vr=!0}Sr(){0===this.br&&(this.Dr("Unknown"),this.vr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.vr=null,this.Cr("Backend didn't respond within 10 seconds."),this.Dr("Offline"),Promise.resolve()))))}Nr(t){"Online"===this.state?this.Dr("Unknown"):(this.br++,this.br>=1&&(this.kr(),this.Cr(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.Dr("Offline")))}set(t){this.kr(),this.br=0,"Online"===t&&(this.Vr=!1),this.Dr(t)}Dr(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}Cr(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Vr?(Js(e),this.Vr=!1):Ys("OnlineStateTracker",e)}kr(){null!==this.vr&&(this.vr.cancel(),this.vr=null)}}class Rl{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.$r=[],this.Or=new Map,this.Fr=new Set,this.Mr=[],this.Lr=i,this.Lr.di((t=>{n.enqueueAndForget((async()=>{Ol(this)&&(Ys("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=ro(t);e.Fr.add(4),await kl(e),e.Br.set("Unknown"),e.Fr.delete(4),await Cl(e)}(this))}))})),this.Br=new Dl(n,r)}}async function Cl(t){if(Ol(t))for(const e of t.Mr)await e(!0)}async function kl(t){for(const e of t.Mr)await e(!1)}function Ol(t){return 0===ro(t).Fr.size}async function Ll(t,e,n){if(!Uu(e))throw e;t.Fr.add(1),await kl(t),t.Br.set("Offline"),n||(n=()=>el(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ys("RemoteStore","Retrying IndexedDB access"),await n(),t.Fr.delete(1),await Cl(t)}))}function Pl(t,e){return e().catch((n=>Ll(t,n,e)))}async function Ml(t){const e=ro(t),n=Hl(e);let r=e.$r.length>0?e.$r[e.$r.length-1].batchId:-1;for(;Fl(e);)try{const t=await nl(e.localStore,r);if(null===t){0===e.$r.length&&n.ir();break}r=t.batchId,Vl(e,t)}catch(t){await Ll(e,t)}Ul(e)&&Bl(e)}function Fl(t){return Ol(t)&&t.$r.length<10}function Vl(t,e){t.$r.push(e);const n=Hl(t);n.er()&&n.pr&&n.Er(e.mutations)}function Ul(t){return Ol(t)&&!Hl(t).tr()&&t.$r.length>0}function Bl(t){Hl(t).start()}async function ql(t){Hl(t).Ar()}async function jl(t){const e=Hl(t);for(const n of t.$r)e.Er(n.mutations)}async function $l(t,e,n){const r=t.$r.shift(),i=Gu.from(r,e,n);await Pl(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await Ml(t)}async function Kl(t,e){e&&Hl(t).pr&&await async function(t,e){if(n=e.code,dc(n)&&n!==Hs.ABORTED){const n=t.$r.shift();Hl(t).sr(),await Pl(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Ml(t)}var n}(t,e),Ul(t)&&Bl(t)}async function zl(t,e){const n=ro(t);e?(n.Fr.delete(2),await Cl(n)):e||(n.Fr.add(2),await kl(n),n.Br.set("Unknown"))}function Hl(t){return t.Kr||(t.Kr=function(t,e,n){const r=ro(t);return r.Pr(),new Nl(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:ql.bind(null,t),Ri:Kl.bind(null,t),Ir:jl.bind(null,t),Tr:$l.bind(null,t)}),t.Mr.push((async e=>{e?(t.Kr.sr(),await Ml(t)):(await t.Kr.stop(),t.$r.length>0&&(Ys("RemoteStore",`Stopping write stream with ${t.$r.length} pending writes`),t.$r=[]))}))),t.Kr}class Gl{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ou,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new Gl(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Gs(Hs.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ql(t,e){if(Js("AsyncQueue",`${e}: ${t}`),Uu(t))return new Gs(Hs.UNAVAILABLE,`${e}: ${t}`);throw t}class Xl{constructor(){this.queries=new Lh((t=>Na(t)),Aa),this.onlineState="Unknown",this.Gr=new Set}}function Wl(t){t.Gr.forEach((t=>{t.next()}))}class Yl{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.bo={},this.vo=new Lh((t=>Na(t)),Aa),this.Vo=new Map,this.So=new Set,this.Do=new gc(Ro.comparator),this.Co=new Map,this.No=new sl,this.xo={},this.ko=new Map,this.$o=Eh.Yt(),this.onlineState="Unknown",this.Oo=void 0}get isPrimaryClient(){return!0===this.Oo}}async function Jl(t,e,n){const r=af(t);try{const t=await function(t,e){const n=ro(t),r=uo.now(),i=e.reduce(((t,e)=>t.add(e.key)),Nc());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>n.Mn.pn(t,i).next((i=>{s=i;const o=[];for(const t of e){const e=ec(t,s.get(t.key));null!=e&&o.push(new sc(t.key,e,zo(e.value.mapValue),Wa.exists(!0)))}return n._n.addMutationBatch(t,r,o,e)})))).then((t=>(t.applyToLocalDocumentSet(s),{batchId:t.batchId,changes:s})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.xo[t.currentUser.toKey()];r||(r=new gc(oo));r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,t.batchId,n),await sf(r,t.changes),await Ml(r.remoteStore)}catch(t){const e=Ql(t,"Failed to persist write");n.reject(e)}}function Zl(t,e,n){const r=ro(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.vo.forEach(((n,r)=>{const i=r.view.zr(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=ro(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.zr(e)&&(r=!0)})),r&&Wl(n)}(r.eventManager,e),t.length&&r.bo._r(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function tf(t,e){const n=ro(t),r=e.batch.batchId;try{const t=await tl(n.localStore,e);rf(n,r,null),nf(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await sf(n,t)}catch(t){await Nh(t)}}async function ef(t,e,n){const r=ro(t);try{const t=await function(t,e){const n=ro(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n._n.lookupMutationBatch(t,e).next((e=>(no(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)))).next((()=>n._n.performConsistencyCheck(t))).next((()=>n.Mn.pn(t,r)))}))}(r.localStore,e);rf(r,e,n),nf(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await sf(r,t)}catch(n){await Nh(n)}}function nf(t,e){(t.ko.get(e)||[]).forEach((t=>{t.resolve()})),t.ko.delete(e)}function rf(t,e,n){const r=ro(t);let i=r.xo[r.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}async function sf(t,e,n){const r=ro(t),i=[],s=[],o=[];r.vo.isEmpty()||(r.vo.forEach(((t,a)=>{o.push(r.Fo(a,e,n).then((t=>{if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=Xh.vn(a.targetId,t);s.push(e)}})))})),await Promise.all(o),r.bo._r(i),await async function(t,e){const n=ro(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Lu.forEach(e,(e=>Lu.forEach(e.Pn,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>Lu.forEach(e.bn,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Uu(t))throw t;Ys("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.kn.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.kn=n.kn.insert(e,i)}}}(r.localStore,s))}async function of(t,e){const n=ro(t);if(!n.currentUser.isEqual(e)){Ys("SyncEngine","User change. New user:",e.toKey());const t=await Zh(n.localStore,e);n.currentUser=e,function(t,e){t.ko.forEach((t=>{t.forEach((t=>{t.reject(new Gs(Hs.CANCELLED,e))}))})),t.ko.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await sf(n,t.Ln)}}function af(t){const e=ro(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=tf.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ef.bind(null,e),e}class cf{constructor(){this.synchronizeTabs=!1}async initialize(t){this.R=Sl(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.Uo(t),await this.persistence.start(),this.gcScheduler=this.qo(t),this.localStore=this.Ko(t)}qo(t){return null}Ko(t){return Jh(this.persistence,new Wh,t.initialUser,this.R)}Uo(t){return new ll(dl.Ps,this.R)}Bo(t){return new ml}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class uf extends cf{constructor(t,e,n){super(),this.Qo=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await rl(this.localStore),await this.Qo.initialize(this,t),await af(this.Qo.syncEngine),await Ml(this.Qo.remoteStore)}Ko(t){return Jh(this.persistence,new Wh,t.initialUser,this.R)}qo(t){const e=this.persistence.referenceDelegate.garbageCollector;return new Rh(e,t.asyncQueue)}Uo(t){const e=Gh(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ph.withCacheSize(this.cacheSizeBytes):ph.DEFAULT;return new Kh(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,El(),Tl(),this.R,this.sharedClientState,!!this.forceOwnership)}Bo(t){return new ml}}class hf{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Zl(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=of.bind(null,this.syncEngine),await zl(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Xl}createDatastore(t){const e=Sl(t.databaseInfo.databaseId),n=(r=t.databaseInfo,new Il(r));var r;return function(t,e,n){return new xl(t,e,n)}(t.credentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=t=>Zl(this.syncEngine,t,0),s=vl.gt()?new vl:new yl,new Rl(e,n,r,i,s);var e,n,r,i,s}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new Yl(t,e,n,r,i,s);return o&&(a.Oo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=ro(t);Ys("RemoteStore","RemoteStore shutting down."),e.Fr.add(5),await kl(e),e.Lr.shutdown(),e.Br.set("Unknown")}(this.remoteStore)}}class lf{constructor(t,e,n){this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=pl.UNAUTHENTICATED,this.clientId=so.u(),this.credentialListener=()=>Promise.resolve(),this.credentials.setChangeListener(e,(async t=>{Ys("FirestoreClient","Received user=",t.uid),await this.credentialListener(t),this.user=t}))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.credentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Gs(Hs.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Ou;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.removeChangeListener(),t.resolve()}catch(e){const n=Ql(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function ff(t,e){t.asyncQueue.verifyOperationInProgress(),Ys("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Zh(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function df(t,e){t.asyncQueue.verifyOperationInProgress();const n=await pf(t);Ys("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener((t=>async function(t,e){const n=ro(t);n.asyncQueue.verifyOperationInProgress(),Ys("RemoteStore","RemoteStore received new credentials");const r=Ol(n);n.Fr.add(3),await kl(n),r&&n.Br.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Fr.delete(3),await Cl(n)}(e.remoteStore,t))),t.onlineComponents=e}async function pf(t){return t.offlineComponents||(Ys("FirestoreClient","Using default OfflineComponentProvider"),await ff(t,new cf)),t.offlineComponents}async function gf(t){return t.onlineComponents||(Ys("FirestoreClient","Using default OnlineComponentProvider"),await df(t,new hf)),t.onlineComponents}function mf(t){return gf(t).then((t=>t.syncEngine))}class yf{constructor(t,e,n,r,i,s,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class vf{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof vf&&t.projectId===this.projectId&&t.database===this.database}}const wf=new Map;class bf{constructor(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${t}`}}class If{constructor(){this.changeListener=null}getToken(){return Promise.resolve(null)}invalidateToken(){}setChangeListener(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(pl.UNAUTHENTICATED)))}removeChangeListener(){this.changeListener=null}}class Ef{constructor(t){this.currentUser=pl.UNAUTHENTICATED,this.oc=new Ou,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.ac=()=>{this.cc++,this.currentUser=this.uc(),this.oc.resolve(),this.changeListener&&this.asyncQueue.enqueueRetryable((()=>this.changeListener(this.currentUser)))};const e=t=>{Ys("FirebaseCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.ac)};t.onInit((t=>e(t))),setTimeout((()=>{if(!this.auth){const n=t.getImmediate({optional:!0});n?e(n):(Ys("FirebaseCredentialsProvider","Auth not yet detected"),this.oc.resolve())}}),0)}getToken(){const t=this.cc,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.cc!==t?(Ys("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(no("string"==typeof e.accessToken),new bf(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}setChangeListener(t,e){this.asyncQueue=t,this.asyncQueue.enqueueRetryable((async()=>{await this.oc.promise,await e(this.currentUser),this.changeListener=e}))}removeChangeListener(){this.auth&&this.auth.removeAuthTokenListener(this.ac),this.changeListener=()=>Promise.resolve()}uc(){const t=this.auth&&this.auth.getUid();return no(null===t||"string"==typeof t),new pl(t)}}class Tf{constructor(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=pl.FIRST_PARTY}get authHeaders(){const t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t}}class Sf{constructor(t,e,n){this.hc=t,this.lc=e,this.fc=n}getToken(){return Promise.resolve(new Tf(this.hc,this.lc,this.fc))}setChangeListener(t,e){t.enqueueRetryable((()=>e(pl.FIRST_PARTY)))}removeChangeListener(){}invalidateToken(){}}function _f(t,e,n){if(!n)throw new Gs(Hs.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Af(t){if(!Ro.isDocumentKey(t))throw new Gs(Hs.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Nf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":eo()}function xf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Gs(Hs.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Nf(t);throw new Gs(Hs.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Df{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Gs(Hs.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=true}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Gs(Hs.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(t,e,n,r){if(!0===e&&!0===r)throw new Gs(Hs.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Rf{constructor(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Df({}),this._settingsFrozen=!1,t instanceof vf?(this._databaseId=t,this._credentials=new If):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Gs(Hs.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vf(t.options.projectId)}(t),this._credentials=new Ef(e))}get app(){if(!this._app)throw new Gs(Hs.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Gs(Hs.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Df(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new If;switch(t.type){case"gapi":const e=t.client;return no(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Sf(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Gs(Hs.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=wf.get(t);e&&(Ys("ComponentProvider","Removing Datastore"),wf.delete(t),e.terminate())}(this),Promise.resolve()}}class Cf{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Of(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Cf(this.firestore,t,this._key)}}class kf{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new kf(this.firestore,t,this._query)}}class Of extends kf{constructor(t,e,n){super(t,e,ya(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Cf(this.firestore,null,new Ro(t))}withConverter(t){return new Of(this.firestore,t,this._path)}}function Lf(t,e,...n){if(t=b(t),1===arguments.length&&(e=so.u()),_f("doc","path",e),t instanceof Rf){const r=mo.fromString(e,...n);return Af(r),new Cf(t,null,new Ro(r))}{if(!(t instanceof Cf||t instanceof Of))throw new Gs(Hs.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(mo.fromString(e,...n));return Af(r),new Cf(t.firestore,t instanceof Of?t.converter:null,new Ro(r))}}class Pf{constructor(){this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.gc=null,this.yc=!1,this.Ec=[],this.Zi=new _l(this,"async_queue_retry"),this.Tc=()=>{const t=Tl();t&&Ys("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Zi.Gi()};const t=Tl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Tc)}get isShuttingDown(){return this._c}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Ic(),this.Ac(t)}enterRestrictedMode(){if(!this._c){this._c=!0;const t=Tl();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Tc)}}enqueue(t){return this.Ic(),this._c?new Promise((t=>{})):this.Ac(t)}enqueueRetryable(t){this.enqueueAndForget((()=>(this.wc.push(t),this.Rc())))}async Rc(){if(0!==this.wc.length){try{await this.wc[0](),this.wc.shift(),this.Zi.reset()}catch(t){if(!Uu(t))throw t;Ys("AsyncQueue","Operation failed with retryable error: "+t)}this.wc.length>0&&this.Zi.ji((()=>this.Rc()))}}Ac(t){const e=this.dc.then((()=>(this.yc=!0,t().catch((t=>{this.gc=t,this.yc=!1;throw Js("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack);return e}(t)),t})).then((t=>(this.yc=!1,t))))));return this.dc=e,e}enqueueAfterDelay(t,e,n){this.Ic(),this.Ec.indexOf(t)>-1&&(e=0);const r=Gl.createAndSchedule(this,t,e,n,(t=>this.Pc(t)));return this.mc.push(r),r}Ic(){this.gc&&eo()}verifyOperationInProgress(){}async bc(){let t;do{t=this.dc,await t}while(t!==this.dc)}vc(t){for(const e of this.mc)if(e.timerId===t)return!0;return!1}Vc(t){return this.bc().then((()=>{this.mc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.mc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.bc()}))}Sc(t){this.Ec.push(t)}Pc(t){const e=this.mc.indexOf(t);this.mc.splice(e,1)}}class Mf extends Rf{constructor(t,e){super(t,e),this.type="firestore",this._queue=new Pf,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Uf(this),this._firestoreClient.terminate()}}function Ff(t,e){const n=gt(t,"firestore-exp");if(n.isInitialized())throw new Gs(Hs.FAILED_PRECONDITION,"Firestore can only be initialized once per app.");if(void 0!==e.cacheSizeBytes&&-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Gs(Hs.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:e})}function Vf(t){return t._firestoreClient||Uf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Uf(t){var e;const n=t._freezeSettings(),r=function(t,e,n,r){return new yf(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new lf(t._credentials,t._queue,r)}function Bf(t,e){jf(t=xf(t,Mf));const n=Vf(t),r=t._freezeSettings(),i=new hf;return qf(n,i,new uf(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function qf(t,e,n){const r=new Ou;return t.asyncQueue.enqueue((async()=>{try{await ff(t,n),await df(t,e),r.resolve()}catch(t){if(!function(t){if("FirebaseError"===t.name)return t.code===Hs.FAILED_PRECONDITION||t.code===Hs.UNIMPLEMENTED;if("undefined"!=typeof DOMException&&t instanceof DOMException)return 22===t.code||20===t.code||11===t.code;return!0}(t))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.reject(t)}})).then((()=>r.promise))}function jf(t){if(t._initialized||t._terminated)throw new Gs(Hs.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class $f{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Gs(Hs.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new vo(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Kf{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Kf(bo.fromBase64String(t))}catch(t){throw new Gs(Hs.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Kf(bo.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class zf{constructor(t){this._methodName=t}}class Hf{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Gs(Hs.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Gs(Hs.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return oo(this._lat,t._lat)||oo(this._long,t._long)}}const Gf=/^__.*__$/;class Qf{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new sc(t,this.data,this.fieldMask,e,this.fieldTransforms):new ic(t,this.data,e,this.fieldTransforms)}}function Xf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw eo()}}class Wf{constructor(t,e,n,r,i,s){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Dc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Cc(){return this.settings.Cc}Nc(t){return new Wf(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}xc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,kc:!1});return r.$c(t),r}Oc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,kc:!1});return r.Dc(),r}Fc(t){return this.Nc({path:void 0,kc:!0})}Mc(t){return ad(t,this.settings.methodName,this.settings.Lc||!1,this.path,this.settings.Bc)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Dc(){if(this.path)for(let t=0;t<this.path.length;t++)this.$c(this.path.get(t))}$c(t){if(0===t.length)throw this.Mc("Document fields must not be empty");if(Xf(this.Cc)&&Gf.test(t))throw this.Mc('Document fields cannot begin and end with "__"')}}class Yf{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Sl(t)}Uc(t,e,n,r=!1){return new Wf({Cc:t,methodName:e,Bc:n,path:vo.emptyPath(),kc:!1,Lc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)}}function Jf(t){const e=t._freezeSettings(),n=Sl(t._databaseId);return new Yf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Zf(t,e,n,r,i,s={}){const o=t.Uc(s.merge||s.mergeFields?2:0,e,n,i);rd("Data must be an object, but it was:",o,r);const a=ed(r,o);let c,u;if(s.merge)c=new wo(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){const i=id(e,r,n);if(!o.contains(i))throw new Gs(Hs.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);cd(t,i)||t.push(i)}c=new wo(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new Qf(new Ko(a),c,u)}function td(t,e){if(nd(t=b(t)))return rd("Unsupported field value:",e,t),ed(t,e);if(t instanceof zf)return function(t,e){if(!Xf(e.Cc))throw e.Mc(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Mc(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.kc&&4!==e.Cc)throw e.Mc("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=td(i,e.Fc(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=b(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return La(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=uo.fromDate(t);return{timestampValue:Oc(e.R,n)}}if(t instanceof uo){const n=new uo(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Oc(e.R,n)}}if(t instanceof Hf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Kf)return{bytesValue:Lc(e.R,t._byteString)};if(t instanceof Cf){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Mc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Fc(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Mc(`Unsupported field value: ${Nf(t)}`)}(t,e)}function ed(t,e){const n={};return po(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):fo(t,((t,r)=>{const i=td(r,e.xc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function nd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof uo||t instanceof Hf||t instanceof Kf||t instanceof Cf||t instanceof zf)}function rd(t,e,n){if(!nd(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=Nf(n);throw"an object"===r?e.Mc(t+" a custom object"):e.Mc(t+" "+r)}}function id(t,e,n){if((e=b(e))instanceof $f)return e._internalPath;if("string"==typeof e)return od(t,e);throw ad("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}const sd=new RegExp("[~\\*/\\[\\]]");function od(t,e,n){if(e.search(sd)>=0)throw ad(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new $f(...e.split("."))._internalPath}catch(r){throw ad(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function ad(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Gs(Hs.INVALID_ARGUMENT,a+t+c)}function cd(t,e){return t.some((t=>t.isEqual(e)))}function ud(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}function hd(t,e,n){t=xf(t,Cf);const r=xf(t.firestore,Mf),i=ud(t.converter,e,n);return ld(r,[Zf(Jf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Wa.none())])}function ld(t,e){return function(t,e){const n=new Ou;return t.asyncQueue.enqueueAndForget((async()=>Jl(await mf(t),e,n))),n.promise}(Vf(t),e)}var fd;!function(t){Ks=t}(wt),pt(new I("firestore-exp",((t,{options:e})=>{const n=t.getProvider("app-exp").getImmediate(),r=new Mf(n,t.getProvider("auth-internal"));return e=Object.assign({useFetchStreams:!1},e),r._setSettings(e),r}),"PUBLIC")),It("@firebase/firestore","0.0.900-exp.57f19127c",fd);var dd=bt({apiKey:"AIzaSyAWmMIPWNAlJ3n9xyRcpfKaUCmnLgTZnMw",authDomain:"its-april.firebaseapp.com",databaseURL:"https://its-april.firebaseio.com",projectId:"its-april",storageBucket:"its-april.appspot.com",messagingSenderId:"984636993069",appId:"1:984636993069:web:ba87f2195f38a997c392a4"});function pd(){return n(this,void 0,void 0,(function(){var t,e,n;return r(this,(function(r){switch(r.label){case 0:t=Ff(dd,{useFetchStreams:true});Bf(t);Ws("debug");e=Lf(t,"foo/bar");r.label=1;case 1:r.trys.push([1,3,,4]);return[4,hd(e,{foo:42})];case 2:r.sent();document.getElementById("status").innerHTML="OK";return[3,4];case 3:n=r.sent();document.getElementById("status").innerHTML="FAIL";return[3,4];case 4:return[2]}}))}))}pd()})();
//# sourceMappingURL=bundle.js.map
